{"version":3,"sources":["gistParsers/chains.js","gistParsers/songs.js","utils/errorLocation.js","settings.js","normalize.js","soundAPI/index.js","index.js","toLetter.js","skeleton.js","getUserInput.js","colors.js","frameBufferCanvasAPI/line.js","frameBufferCanvasAPI/polyStroke.js","frameBufferCanvasAPI/circle.js","frameBufferCanvasAPI/sprite.js","frameBufferCanvasAPI/alphabet.js","frameBufferCanvasAPI/print.js","frameBufferCanvasAPI/index.js","frameBufferCanvasAPI/rect.js","utils/runningSum.js","gistParsers/game.js","Iframe.js","utils/screenTypes.js","store/initialState.js","blankTemplate.js","utils/bios.js","frameBufferCanvasAPI/pixelData.js","contextCanvasAPI/trimCanvas.js","validateToken.js","createReducer.js","gistParsers/map.js","gistParsers/sprites.js","gistParsers/phrases.js"],"names":["__webpack_require__","d","__webpack_exports__","extractGistChains","lodash__WEBPACK_IMPORTED_MODULE_0__","lodash__WEBPACK_IMPORTED_MODULE_0___default","n","_store_initialState_js__WEBPACK_IMPORTED_MODULE_1__","data","JSON","parse","_","get","stringify","initialState","chains","extractGistSongs","songs","getEvaledErrorPosition","detect_browser__WEBPACK_IMPORTED_MODULE_0__","browser","detect","regexLookup","chrome","firefox","edge","error","regex","name","stack","match","exec","line","column","settings","octaves","volumes","phrases","matrixLength","chainChannels","startOffset","startOffsetDouble","bpm","subdivision","normalize","volume","vol","note","slowToFastTempo","fastToSlowTempo","concat","reverse","tempoToPlaybackRate","tempo","tempoToSubdivision","map","i","16n","createSynth","_ref","synth","volumeNode","index","Tone","oscillator","type","width","envelope","release","script8Name","chain","triggerAttack","_ref2","letter","octave","_ref2$time","time","currentTime","toLetter","velocity","triggerAttackRelease","_ref3","_ref3$time","duration","triggerRelease","_ref4","_ref4$time","_ref4$delay","delay","soundAPI","chainSynths","range","songSynths","phraseSynth","value","start","songContainers","chainContainers","localPhrases","phrasePool","stopChain","forEach","_ref5","key","sequence","stop","stopSong","_ref6","makeChainContainer","_ref8","notePositions","Math","pow","_$padStart$split$map","padStart","toString","split","parseInt","_$padStart$split$map2","Object","slicedToArray","phrasePosition","notePosition","phrasesIndices","channel","result","phraseIndex","isNil","phrase","noteElement","notes","dropRightWhile","compact","isEmpty","callback","position","length","objectSpread","valueOf","events","makeSongContainer","_ref9","song","_$padStart$split$map3","_$padStart$split$map4","chainPosition","chainIndex","playPhrase","number","pop","dispose","loop","playbackRate","push","playChain","arguments","undefined","playSong","makeSongsAndChains","_ref7","mapValues","r","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","react_dom__WEBPACK_IMPORTED_MODULE_1__","react_dom__WEBPACK_IMPORTED_MODULE_1___default","_Iframe__WEBPACK_IMPORTED_MODULE_2__","ReactDOM","render","a","createElement","document","getElementById","letterToNumber","indexOf","includeOctave","numberToNote","floor","numberToOctave","allowedKeys","previousUserInput","getUserInput","keys","buttons","window","navigator","getGamepads","newUserInput","__mousedown","has","up","pressed","right","down","left","b","select","_i","_Object$keys","startsWith","keyPressed","keyReleased","triplets","rgbStrings","g","intLookup","values","possiblyNegativeInteger","reverseIntLookup","colors","rgb","triplet","int","shouldHighlight","clamp","lookupInt","drawLine","x1","y1","x2","y2","setPixel","color","steep","abs","dx","dy","derror","y","x","drawPolyStroke","points","args","c","newPoints","xRot","yRot","midX","midY","p","toConsumableArray","cos","PI","sin","xs","ys","min","apply","max","Error","round","drawCircle","cx","cy","radius","onlyStroke","err","drawReflectedPair","drawSprite","spriteIndex","darken","flipH","flipV","sprites","slice","cells","rowIndex","colIndex","clamped","alphabet","<",">","/",":","|","(",")","0","1","2","3","4","5","6","7","8","9"," ",".",",","+","-","!","?","e","f","h","j","k","l","m","o","q","s","t","u","v","w","z","drawText","letters","currentX","currentY","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","pixels","toLowerCase","letterWidth","return","injectHighlight","code","canvasAPI","canvasWidth","canvasHeight","height","_ref$map","initialMap","_runningMap","_cameraX","_cameraY","_colorSwaps","newColor","sprite","camera","clear","fill","colorSwap","from","to","getPixel","polyStroke","_len","Array","_key","rectStroke","top","bottom","drawRectStroke","rectFill","rectX","drawRectFill","circStroke","circFill","print","getTile","mx","my","tile","setTile","spriteNumber","row","rowNumber","colNumber","resetMap","runningSum","array","reduce","acc","cur","idx","previous","assembleOrderedGame","game","decorate","orderBy","tab","callUnderMouse","text","node","before","nodeCode","end","after","decorateTabCode","filter","join","parseGistGame","misc","content","lines","ranges","contentLines","defineProperty","active","platform","console","log","version","getUniqueErrorMessages","errors","sortBy","uniqBy","init","update","drawActors","draw","_script8","embedState","reservedTokens","Set","NOOP","FPS","REDUX_HISTORY_SECONDS","CANVAS_SIZE","ACTOR_FRAME_SKIP","Iframe","props","_this","_Users_floritg_Documents_other_script_8_github_io_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_3__","this","_Users_floritg_Documents_other_script_8_github_io_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_5__","_Users_floritg_Documents_other_script_8_github_io_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_6__","call","ArrowUpElement","setArrowUpRef","ArrowRightElement","setArrowRightRef","ArrowDownElement","setArrowDownRef","ArrowLeftElement","setArrowLeftRef","aElement","setaRef","bElement","setbRef","EnterElement","setEnterRef","SpaceElement","setSpaceRef","touchstartArrowUp","bind","_Users_floritg_Documents_other_script_8_github_io_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_8__","touchstartArrowRight","touchstartArrowDown","touchstartArrowLeft","touchstarta","touchstartb","touchstartEnter","touchstartSpace","touchendArrowUp","touchendArrowRight","touchendArrowDown","touchendArrowLeft","touchenda","touchendb","touchendEnter","touchendSpace","addLog","sendLogsToParent","logs","sendErrorToParent","loggerErrors","printErrorsToCassetteScreen","updateGlobals","evalCode","startTimer","handleTimelineInput","handleActorClick","handlePauseClick","handleRestartClick","heightSent","shadows","blacklist","timer","previousElapsed","pastFpsValues","reducer","createReducer","store","previousInitString","reduxHistory","reduxLogger","action","_Users_floritg_Documents_other_script_8_github_io_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_2__","state","getState","soundFunctions","songSequences","started","fps","timelineIndex","actors","selectedActors","message","callbacks","isPaused","alteredStates","run","sound","isTouchScreen","_pixelData","pixelData","classList","add","remove","delete","isEmbed","_this$state","ports","postMessage","_ref$error","_this$state2","errorData","errorMessages","chunk","errorMessage","theString","writePixelDataToCanvas","providedGlobals","globals","frameBufferCanvasAPI","_Users_floritg_Documents_other_script_8_github_io_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","StateMachine","ctx","_canvas","getContext","flatten","random","_this2","mousedownHandler","mouseupHandler","keydownHandler","event","altKey","metaKey","ctrlKey","includes","preventDefault","shortcut","stopPropagation","keyupHandler","addEventListener","setState","handleData","_message$data","payload","_Users_floritg_Documents_other_script_8_github_io_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__","invalidTokenIndex","tokens","findIndex","token","validateToken","smallCanvas","drawImage","toDataURL","SCRIPT_8_EMBEDDED_GIST_ID","fetch","process","then","response","json","gist","bios","isDoneFetching","extractGistPhrases","extractGistSprites","extractGistMap","removeEventListener","_this3","once","endCallback","shadowString","innerSkeleton","skeleton","eval","_this4","interval","elapsed","newFps","tickLength","sum","userInput","dispatch","input","drawUserGraphics","target","actorName","Date","now","forceUpdate","stopTimer","prevProps","prevState","_this5","equal","mute","_ul","querySelectorAll","canvases","actor","lilCanvas","trimCanvas","appendChild","createStore","newTimelineIndex","stateToDraw","allActors","id","matchingActors","lastAlteredState","storeState","applyMiddleware","body","querySelector","scrollHeight","_this6","_this$state3","react__WEBPACK_IMPORTED_MODULE_9___default","className","ref","classNames","show","onTouchStart","onTouchEnd","invisible","onClick","hide","onChange","Component","screenTypes","BOOT","HOME","RUN","HELP","CODE","SPRITE","MAP","SONG","CHAIN","PHRASE","SHELF","hideMenu","iframeVersion","errorLine","screen","booted","nextAction","docHistories","dismissedNotices","selectedUi","tutorial","shelving","_package_json__WEBPACK_IMPORTED_MODULE_0__","_skeleton_js__WEBPACK_IMPORTED_MODULE_1__","boot","ImageData","_pixelBuffer","ArrayBuffer","_pixelBytes","Uint8ClampedArray","Uint32Array","set","putImageData","getImageData","bound","copyCanvas","copy","trimHeight","trimWidth","side","trimmed","canvas","isValid","hasOwnProperty","logger","newState","omit_empty__WEBPACK_IMPORTED_MODULE_1__","omit_empty__WEBPACK_IMPORTED_MODULE_1___default","_store_initialState_js__WEBPACK_IMPORTED_MODULE_2__","_toLetter_js__WEBPACK_IMPORTED_MODULE_3__","omitEmpty","phraseIsArray","isArray","keyBy","omit"],"mappings":"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","file":"static/js/main.61017d12.chunk.js","sourcesContent":["import _ from 'lodash'\nimport initialState from '../store/initialState.js'\n\nconst extractGistChains = data =>\n  JSON.parse(\n    _.get(\n      data,\n      'files[\"chains.json\"].content',\n      JSON.stringify(initialState.chains, null, 2)\n    )\n  )\n\nexport { extractGistChains }\n","import _ from 'lodash'\nimport initialState from '../store/initialState.js'\n\nconst extractGistSongs = data =>\n  JSON.parse(\n    _.get(\n      data,\n      'files[\"songs.json\"].content',\n      JSON.stringify(initialState.songs, null, 2)\n    )\n  )\n\nexport { extractGistSongs }\n","import { detect } from 'detect-browser'\n\nconst browser = detect()\n\nconst regexLookup = {\n  /* Chrome Stack Trace Example:\n\n     TypeError: Cannot read property 'toString' of undefined\n     at print (print.js:7)\n     at print (index.js:72)\n     at draw (eval at <anonymous> (eval at evalCode (Iframe.js:644)), <anonymous>:2:3)\n     at Iframe.drawUserGraphics (Iframe.js:397)\n     at timerCallback (Iframe.js:702)\n     at tick (interval.js:10)\n     at timerFlush (timer.js:61)\n     at wake (timer.js:71)\n  */\n  chrome: /\\(eval at <anonymous> \\(eval at evalCode \\(.+:\\d+\\)\\), <anonymous>:(\\d+):(\\d+)\\)/,\n  /* Firefox Stack Trace Example:\n\n     print@http://localhost:3001/static/js/bundle.js:69091:7\n     print@http://localhost:3001/static/js/bundle.js:68699:7\n     draw@http://localhost:3001/static/js/bundle.js line 67598 > eval line 6 > eval:2:3\n     drawUserGraphics@http://localhost:3001/static/js/bundle.js:67340:9\n     timerCallback@http://localhost:3001/static/js/bundle.js:67650:11\n     tick@http://localhost:3001/static/js/bundle.js:1475:5\n     timerFlush@http://localhost:3001/static/js/bundle.js:1580:40\n     wake@http://localhost:3001/static/js/bundle.js:1590:5\n\n  */\n  firefox: /line \\d+ > eval line \\d+ > eval:(\\d+):(\\d+)/,\n  /* Edge Stack Trace Example:\n\n     TypeError: Unable to get property 'toString' of undefined or null reference\n     at print (http://localhost:3001/static/js/bundle.js:69091:3)\n     at print (http://localhost:3001/static/js/bundle.js:68699:7)\n     at draw (eval code:2:3)\n     at drawUserGraphics (http://localhost:3001/static/js/bundle.js:67340:9)\n     at timerCallback (http://localhost:3001/static/js/bundle.js:67650:11)\n     at tick (http://localhost:3001/static/js/bundle.js:1475:5)\n     at timerFlush (http://localhost:3001/static/js/bundle.js:1580:40)\n     at wake (http://localhost:3001/static/js/bundle.js:1590:5)\n  */\n  edge: /\\(eval code:(\\d+):(\\d+)\\)/\n}\n\nexport function getEvaledErrorPosition(error) {\n  const regex = regexLookup[browser.name]\n  if (regex && error.stack) {\n    const match = regex.exec(error.stack)\n    if (match) {\n      return {\n        line: match[1],\n        column: match[2]\n      }\n    }\n  } else if (browser.name === 'safari') {\n    return {\n      line: error.line,\n      column: error.column\n    }\n  }\n}\n","const settings = {\n  octaves: 4,\n  volumes: 8,\n  phrases: 8 * 8,\n  chains: 8 * 8,\n  songs: 8,\n  matrixLength: 16,\n  chainChannels: 4,\n  startOffset: '+0.1',\n  startOffsetDouble: '+0.5',\n  bpm: 144 * 8,\n  subdivision: '2m'\n}\n\nexport default settings\n","import settings from './settings.js'\nconst normalize = {\n  volume: vol => (vol + 1) / settings.volumes,\n  note: note => note\n}\n\nexport default normalize\n","// TODO\n\n// - if sustain exists, volume should also just show `-`\n// - add new API functions to docs and remove `not stable`\n\nimport * as Tone from 'tone'\nimport _ from 'lodash'\nimport toLetter from '../toLetter.js'\nimport normalize from '../normalize.js'\nimport settings from '../settings.js'\n\nconst slowToFastTempo = [1, 2, 3, 5, 8, 12, 20, 32]\nconst fastToSlowTempo = [...slowToFastTempo].reverse()\n\nconst tempoToPlaybackRate = tempo => slowToFastTempo[tempo]\nconst tempoToSubdivision = tempo =>\n  fastToSlowTempo.map(i => ({ '16n': i }))[tempo]\n\nconst createSynth = ({ volumeNode, index }) => {\n  let synth\n\n  if (index === 0) {\n    synth = new Tone.Synth({\n      oscillator: {\n        type: 'pulse',\n        width: 0.5\n      },\n      envelope: {\n        release: 0.07\n      }\n    })\n    synth.script8Name = 'synth'\n  }\n\n  if (index === 1) {\n    synth = new Tone.Synth({\n      oscillator: {\n        type: 'pulse',\n        width: 0.75\n      },\n      envelope: {\n        release: 0.07\n      }\n    })\n    synth.script8Name = 'synth'\n  }\n\n  if (index === 2) {\n    synth = new Tone.Synth({\n      oscillator: {\n        type: 'triangle'\n      },\n      envelope: {\n        release: 0.07\n      }\n    })\n    synth.script8Name = 'synth'\n  }\n\n  if (index === 3) {\n    synth = new Tone.NoiseSynth({\n      envelope: {\n        release: 0.07\n      }\n    })\n    synth.script8Name = 'noise'\n  }\n\n  if (volumeNode) {\n    synth.chain(volumeNode, Tone.Master)\n  } else {\n    synth.chain(Tone.Master)\n  }\n\n  return synth\n}\n\nconst triggerAttack = ({\n  note: letter,\n  octave,\n  volume,\n  time = Tone.context.currentTime,\n  synth\n}) => {\n  if (time >= Tone.context.currentTime) {\n    const note = toLetter(letter + octave * 12, true, true)\n    const velocity = normalize.volume(volume)\n    if (synth.script8Name === 'synth') {\n      synth.triggerAttack(note, time, velocity)\n    }\n    if (synth.script8Name === 'noise') {\n      synth.triggerAttack(time, velocity)\n    }\n  }\n}\n\nconst triggerAttackRelease = ({\n  note: letter,\n  octave,\n  volume,\n  time = Tone.context.currentTime,\n  synth,\n  tempo\n}) => {\n  if (time >= Tone.context.currentTime) {\n    const note = toLetter(letter + octave * 12, true, true)\n    const duration = tempoToSubdivision(tempo)\n    const velocity = normalize.volume(volume)\n    if (synth.script8Name === 'synth') {\n      synth.triggerAttackRelease(note, duration, time, velocity)\n    }\n    if (synth.script8Name === 'noise') {\n      synth.triggerAttackRelease(duration, time, velocity)\n    }\n  }\n}\n\nconst triggerRelease = ({\n  time = Tone.context.currentTime,\n  delay = 0,\n  synth\n}) => {\n  if (time >= Tone.context.currentTime) {\n    synth.triggerRelease(time + delay)\n  }\n}\n\nconst soundAPI = volumeNode => {\n  const chainSynths = _.range(settings.chainChannels).map(index =>\n    createSynth({ volumeNode, index })\n  )\n  const songSynths = _.range(settings.chainChannels).map(index =>\n    createSynth({ volumeNode, index })\n  )\n  const phraseSynth = createSynth({ volumeNode, index: 0 })\n\n  Tone.Transport.bpm.value = settings.bpm\n  Tone.Transport.start(settings.startOffset)\n\n  let songContainers = {}\n  let chainContainers = {}\n  let localPhrases = {}\n  let phrasePool = []\n\n  const stopChain = () => {\n    _.forEach(chainContainers, ({ sequence }, key) => {\n      if (sequence) {\n        sequence.stop()\n        chainSynths.forEach(synth => triggerRelease({ synth }))\n      }\n    })\n  }\n\n  const stopSong = () => {\n    // Stop all sequences.\n    // console.log('soundAPI.stopSong() BEGIN----------')\n    // const before = Date.now()\n    _.forEach(songContainers, ({ sequence }, key) => {\n      if (sequence) {\n        sequence.stop()\n        songSynths.forEach(synth => triggerRelease({ synth }))\n        // console.log(`stopping song with key: ${key}`)\n      }\n    })\n    // const after = Date.now()\n    // console.log(`soundAPI.stopSong() END ${after - before}ms`)\n  }\n\n  const makeSongsAndChains = ({ songs, chains, phrases }) => {\n    // console.log(`soundAPI.makeSongs() BEGIN----------`)\n    // const before = Date.now()\n    stopSong()\n    stopChain()\n    localPhrases = phrases\n    songContainers = _.mapValues(songs, song =>\n      makeSongContainer({ song, chains, phrases })\n    )\n    chainContainers = _.mapValues(chains, chain =>\n      makeChainContainer({ chain, phrases })\n    )\n    // const after = Date.now()\n    // console.log(`soundAPI.makeSongs() END ${after - before}ms`)\n  }\n\n  const makeChainContainer = ({ chain, phrases }) => {\n    const notePositions = _(_.range(Math.pow(settings.matrixLength, 2)))\n      .map(index => {\n        // Get the phrase and note positions by using base math.\n        const [phrasePosition, notePosition] = _.padStart(\n          index.toString(settings.matrixLength),\n          2,\n          0\n        )\n          .split('')\n          .map(d => parseInt(d, settings.matrixLength))\n\n        // Get the phrase indices for this position, e.g. { 0: 0, 1: 11, 2: 2 }\n        const phrasesIndices = _.get(chain, phrasePosition)\n\n        // For each channel,\n        return _.range(settings.chainChannels).map(channel => {\n          // Get the phrase index for this channel.\n          const phraseIndex = _.get(phrasesIndices, channel)\n          let result\n\n          // If the phrase index exists,\n          if (!_.isNil(phraseIndex)) {\n            // get the phrase assigned to this channel.\n            const phrase = _.get(phrases, phraseIndex, {})\n\n            // Get the note element for this position.\n            const noteElement = _.get(phrase.notes, notePosition)\n\n            // If we have a note,\n            if (!_.isNil(noteElement)) {\n              // add it to the result.\n              result = {\n                noteElement,\n                tempo: chain.tempo\n              }\n            }\n          }\n          return result\n        })\n      })\n      // NOW we can drop from right.\n      .dropRightWhile(d =>\n        _(d)\n          .compact()\n          .isEmpty()\n      )\n      .value()\n\n    const callback = (time, position) => {\n      // For every column cell on the grid,\n      notePositions[position].forEach((d, channel) => {\n        // if the channel has a note:\n        if (d && !_.isNil(d.noteElement)) {\n          // If we're on the last position of the entire array,\n          if (position === notePositions.length - 1) {\n            // if we have a note, triggerAttackRelease.\n            if (d.noteElement.octave > -1) {\n              triggerAttackRelease({\n                ...d.noteElement,\n                time,\n                synth: chainSynths[channel],\n                tempo: d.tempo\n              })\n            }\n            // If we have a sustain, triggerRelease(time + duration).\n            if (d.noteElement.octave === -1) {\n              triggerRelease({\n                time,\n                synth: chainSynths[channel],\n                delay: Tone.Time(tempoToSubdivision(d.tempo)).valueOf()\n              })\n            }\n          } else {\n            // If we're not on the last position of the array,\n            // if we have a note, triggerAttack.\n            if (d.noteElement.octave > -1) {\n              triggerAttack({\n                ...d.noteElement,\n                time,\n                synth: chainSynths[channel]\n              })\n            }\n            // If we have a sustain, do nothing.\n            if (d.noteElement.octave === -1) {\n            }\n          }\n        } else {\n          // If the channel does not have a note, stop it.\n          triggerRelease({ time, synth: chainSynths[channel] })\n        }\n      })\n    }\n\n    const events = _.range(notePositions.length)\n\n    return {\n      callback,\n      events,\n      sequence: null,\n      tempo: chain.tempo\n    }\n  }\n\n  const makeSongContainer = ({ song, chains, phrases }) => {\n    // const before = Date.now()\n    // Create an array of note positions.\n    // There's a lot going on here, but the gist:\n    // create an array of all the notes, but remove nulls from the end,\n    // so that we can make a Tone Sequence that is the right length and no more.\n    // This is good for performance.\n\n    // For matrixLength cubed (chains * phrases * notes),\n    const notePositions = _(_.range(Math.pow(settings.matrixLength, 3)))\n      .map(index => {\n        // Get the chain, phrase and note positions by using base math.\n        const [chainPosition, phrasePosition, notePosition] = _.padStart(\n          index.toString(settings.matrixLength),\n          3,\n          0\n        )\n          .split('')\n          .map(d => parseInt(d, settings.matrixLength))\n\n        // Get the chain index for this position.\n        const chainIndex = _.get(song, chainPosition)\n\n        // Get the chain.\n        const chain = _.get(chains, chainIndex)\n\n        // Get the phrase indices for this position, e.g. { 0: 0, 1: 11, 2: 2 }\n        const phrasesIndices = _.get(chain, phrasePosition)\n\n        // For each channel,\n        return _.range(settings.chainChannels).map(channel => {\n          // Get the phrase index for this channel.\n          const phraseIndex = _.get(phrasesIndices, channel)\n          let result\n\n          // If the phrase index exists,\n          if (!_.isNil(phraseIndex)) {\n            // get the phrase assigned to this channel.\n            const phrase = _.get(phrases, phraseIndex, {})\n\n            // Get the note element for this position.\n            const noteElement = _.get(phrase.notes, notePosition)\n\n            // If we have a note,\n            if (!_.isNil(noteElement)) {\n              // add it to the result.\n              result = {\n                noteElement,\n                tempo: song.tempo\n              }\n            }\n          }\n          return result\n        })\n      })\n      // NOW we can drop from right.\n      .dropRightWhile(d =>\n        _(d)\n          .compact()\n          .isEmpty()\n      )\n      .value()\n\n    const callback = (time, position) => {\n      // For every column cell on the grid,\n      notePositions[position].forEach((d, channel) => {\n        // if the channel has a note:\n        if (d && !_.isNil(d.noteElement)) {\n          // If we're on the last position of the entire array,\n          if (position === notePositions.length - 1) {\n            // if we have a note, triggerAttackRelease.\n            if (d.noteElement.octave > -1) {\n              triggerAttackRelease({\n                ...d.noteElement,\n                time,\n                synth: songSynths[channel],\n                tempo: d.tempo\n              })\n            }\n            // If we have a sustain, triggerRelease(time + duration).\n            if (d.noteElement.octave === -1) {\n              triggerRelease({\n                time,\n                synth: songSynths[channel],\n                delay: Tone.Time(tempoToSubdivision(d.tempo)).valueOf()\n              })\n            }\n          } else {\n            // If we're not on the last position of the array,\n            // if we have a note, triggerAttack.\n            if (d.noteElement.octave > -1) {\n              triggerAttack({\n                ...d.noteElement,\n                time,\n                synth: songSynths[channel]\n              })\n            }\n            // If we have a sustain, do nothing.\n            if (d.noteElement.octave === -1) {\n            }\n          }\n        } else {\n          // If the channel does not have a note, stop it.\n          triggerRelease({ time, synth: songSynths[channel] })\n        }\n      })\n    }\n\n    const events = _.range(notePositions.length)\n\n    // const after = Date.now()\n    // console.log(`soundAPI.makeSongContainer() took ${after - before}ms`)\n\n    return {\n      callback,\n      events,\n      sequence: null,\n      tempo: song.tempo\n    }\n  }\n\n  const playSong = (number, loop = false) => {\n    // console.log(`soundAPI.playSong() BEGIN----------`)\n    // const before = Date.now()\n    stopSong()\n\n    // console.log(`going to play song with key ${number}`)\n    _.forEach(songContainers, (value, key) => {\n      if (+key === number) {\n        // console.log(`found one: key ${key}`)\n        value.sequence = new Tone.Sequence(\n          value.callback,\n          value.events,\n          settings.subdivision\n        )\n        value.sequence.loop = loop\n        value.sequence.playbackRate = tempoToPlaybackRate(value.tempo)\n        value.sequence.start(settings.startOffset)\n      }\n    })\n    // const after = Date.now()\n    // console.log(`soundAPI.playSong() END took ${after - before}ms`)\n  }\n\n  const playChain = (number, loop = false) => {\n    // console.log(`soundAPI.playSong() BEGIN----------`)\n    // const before = Date.now()\n    stopChain()\n\n    // console.log(`going to play song with key ${number}`)\n    _.forEach(chainContainers, (value, key) => {\n      if (+key === number) {\n        // console.log(`found one: key ${key}`)\n        value.sequence = new Tone.Sequence(\n          value.callback,\n          value.events,\n          settings.subdivision\n        )\n        value.sequence.loop = loop\n        value.sequence.playbackRate = tempoToPlaybackRate(value.tempo)\n        value.sequence.start(settings.startOffset)\n      }\n    })\n    // const after = Date.now()\n    // console.log(`soundAPI.playSong() END took ${after - before}ms`)\n  }\n\n  const playPhrase = number => {\n    // const before = Date.now()\n    const phrase = _.get(localPhrases, number)\n    if (phrase) {\n      while (phrasePool.length) {\n        const popped = phrasePool.pop()\n        popped.dispose()\n      }\n\n      const { tempo } = phrase\n\n      const sequence = new Tone.Sequence(\n        (time, index) => {\n          const value = phrase.notes[index]\n          // if (value) {\n          //   playNote({ ...value, time, synth: phraseSynth, tempo })\n          // }\n\n          // If there is a note,\n          if (value) {\n            // If we're on the last position of the phrase,\n            if (index === settings.matrixLength - 1) {\n              // if we have a note, triggerAttackRelease.\n              // If we have a sustain, triggerRelease(time + duration).\n              if (value.octave > -1) {\n                triggerAttackRelease({\n                  ...value,\n                  time,\n                  synth: phraseSynth,\n                  tempo\n                })\n              }\n              if (value.octave === -1) {\n                triggerRelease({\n                  time,\n                  synth: phraseSynth,\n                  delay: Tone.Time(tempoToSubdivision(tempo)).valueOf()\n                })\n              }\n            } else {\n              // If we're not on the last position of the array,\n              // if we have a note, triggerAttack.\n              if (value.octave > -1) {\n                triggerAttack({\n                  ...value,\n                  time,\n                  synth: phraseSynth\n                })\n              }\n              // If it's sustain, do nothing.\n              if (value.octave === -1) {\n              }\n            }\n          } else {\n            // If there is no note, triggerRelease.\n            triggerRelease({ time, synth: phraseSynth })\n          }\n        },\n        _.range(settings.matrixLength),\n        settings.subdivision\n      )\n      sequence.loop = false\n      sequence.playbackRate = tempoToPlaybackRate(tempo)\n      sequence.start()\n      phrasePool.push(sequence)\n      // const after = Date.now()\n      // console.log(`soundAPI.playPhrase() took ${after - before}ms`)\n    }\n  }\n  return {\n    playPhrase,\n    playChain,\n    stopChain,\n    playSong,\n    stopSong,\n    makeSongsAndChains\n  }\n}\n\nexport {\n  createSynth,\n  tempoToPlaybackRate,\n  triggerAttack,\n  triggerAttackRelease,\n  triggerRelease\n}\n\nexport default soundAPI\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport Iframe from './Iframe'\n\nReactDOM.render(<Iframe />, document.getElementById('root'))\n","const notes = ['c', 'c#', 'd', 'd#', 'e', 'f', 'f#', 'g', 'g#', 'a', 'a#', 'b']\n\nconst numberToNote = number => notes[number % notes.length]\n\nconst numberToOctave = number => Math.floor(number / notes.length)\n\nconst toLetter = (number, includeOctave, normalize) => {\n  const letter = numberToNote(number)\n  const octave = numberToOctave(number) + (normalize ? 2 : 0)\n  return !includeOctave ? letter : `${letter}${octave}`\n}\n\nconst letterToNumber = letter => notes.indexOf(letter)\n\nexport { numberToOctave, letterToNumber }\n\nexport default toLetter\n","export default `init = state => {\n}\n\nupdate = (state, input, elapsed) => {\n}\n\ndrawActors = (state, fade) =>\n  state.actors && state.actors.forEach(actor =>\n    sprite(\n      actor.x,\n      actor.y,\n      actor.sprite,\n      fade ? actor.trailBrighten || -3 : actor.brighten,\n      actor.flipH,\n      actor.flipV\n    )\n  )\n\ndraw = state => {\n  camera()\n  clear()\n}`\n","let previousUserInput = {}\n\nconst allowedKeys = [\n  'mousedown',\n  'ArrowUp',\n  'ArrowRight',\n  'ArrowDown',\n  'ArrowLeft',\n  'a',\n  'b',\n  'Enter',\n  ' '\n]\n\nconst getUserInput = keys => {\n  const { buttons } = window.navigator.getGamepads\n    ? window.navigator.getGamepads()[0] || {}\n    : {}\n\n  let newUserInput = {\n    __mousedown: keys.has('mousedown'),\n    up: keys.has('ArrowUp') || (buttons && buttons[12].pressed),\n    right: keys.has('ArrowRight') || (buttons && buttons[15].pressed),\n    down: keys.has('ArrowDown') || (buttons && buttons[13].pressed),\n    left: keys.has('ArrowLeft') || (buttons && buttons[14].pressed),\n    a: keys.has('a') || (buttons && (buttons[1].pressed || buttons[2].pressed)),\n    b: keys.has('b') || (buttons && (buttons[0].pressed || buttons[3].pressed)),\n    start: keys.has('Enter') || (buttons && buttons[9].pressed),\n    select: keys.has(' ') || (buttons && buttons[8].pressed)\n  }\n\n  for (const key of Object.keys(newUserInput)) {\n    if (key.startsWith('__')) continue\n\n    let keyPressed = !previousUserInput[key] && newUserInput[key]\n    newUserInput[key + 'Pressed'] = keyPressed\n\n    let keyReleased = previousUserInput[key] && !newUserInput[key]\n    newUserInput[key + 'Released'] = keyReleased\n  }\n\n  previousUserInput = newUserInput\n\n  return newUserInput\n}\n\nexport { allowedKeys }\n\nexport default getUserInput\n","import clamp from 'lodash/clamp'\nimport { shouldHighlight } from './frameBufferCanvasAPI/index'\n\n// Lookup table for triplet arrays containing R, G, and B values.\nconst triplets = [\n  [246, 214, 189],\n  [195, 163, 138],\n  [153, 117, 119],\n  [129, 98, 113],\n  [78, 73, 95],\n  [32, 57, 79],\n  [15, 42, 63],\n  [8, 20, 30]\n]\n\n// Lookup table for the css color strings.\nconst rgbStrings = triplets.map(([r, g, b]) => `rgb(${r},${g},${b})`)\n\n// Lookup tree for the combined integer representation of each color.\nlet intLookup = []\n\n// Loops over each of the color indexes, looks up associated color triplet, and\n// calculates the equivalent integer representation by bit shifting each byte\n// into the correct position.\nfor (let i = 0; i < 8; i++) {\n  let values = triplets[i]\n\n  // Shift each byte into the correct integer position.\n  let possiblyNegativeInteger =\n    (255 << 24) | // Alpha byte\n    (values[2] << 16) | // B byte\n    (values[1] << 8) | // G byte\n    values[0] // R byte\n\n  // Set the positive version of the above calculated integer into the lookup\n  // table. A bitwise right shift of 0 places forces the number to be\n  // interpreted as a positive integer.\n  intLookup[i] = possiblyNegativeInteger >>> 0\n\n  // For example, intLookup[0] = 4290631414.\n}\n\n// The opposite of the intLookup. Each index is the color integer, and the value\n// is the SCRIPT-8 integer color.\nconst reverseIntLookup = {}\nfor (let i = 0; i < 8; i++) {\n  reverseIntLookup[intLookup[i]] = i\n}\n\nconst colors = {\n  rgb(i) {\n    return rgbStrings[i % rgbStrings.length]\n  },\n\n  triplet(i) {\n    return triplets[i % triplets.length]\n  },\n\n  int(i) {\n    let index = i % intLookup.length;\n    // `shouldHighlight` is injected in the use code when the current call is under the mouse. If it is true, all colors\n    // drawn are brightened by 2 steps if they can be, or darkened by two steps if they are already too bright\n    if (shouldHighlight) {\n      if (index > 2) index = clamp(+index - 2, 0, 7)\n      else index += 2\n    }\n    return intLookup[index]\n  },\n\n  // Looks up the integer value in the reverseIntLookup table. If it doesn't\n  // exist, then the background color of 7 is returned instead.\n  lookupInt(int) {\n    if (int in reverseIntLookup) {\n      return reverseIntLookup[int]\n    }\n    return 7\n  }\n}\n\nexport default colors\n","const drawLine = ({ x1, y1, x2, y2, setPixel, color }) => {\n  let steep = false\n\n  if (Math.abs(x1 - x2) < Math.abs(y1 - y2)) {\n    ;[x1, y1] = [y1, x1]\n    ;[x2, y2] = [y2, x2]\n    steep = true\n  }\n  if (x1 > x2) {\n    ;[x1, x2] = [x2, x1]\n    ;[y1, y2] = [y2, y1]\n  }\n\n  const dx = x2 - x1\n  const dy = y2 - y1\n  const derror = Math.abs(dy) * 2\n  let error = 0\n  let y = y1\n\n  for (let x = x1; x <= x2; x++) {\n    if (steep) {\n      setPixel(y, x, color)\n    } else {\n      setPixel(x, y, color)\n    }\n    error += derror\n    if (error > dx) {\n      if (y2 > y1) {\n        y++\n      } else {\n        y--\n      }\n      error -= dx * 2\n    }\n  }\n}\n\nexport default drawLine\n","const drawPolyStroke = ({ points, args, line }) => {\n  if (!points.length) {\n    return\n  }\n  let c, newPoints, xRot, yRot, midX, midY\n  switch (args.length) {\n    case 1:\n      // polyStroke(points, color)\n      newPoints = points.map(p => [...p])\n      c = args[0]\n      break\n    case 2:\n      // polyStroke(points, rotate, color)\n      xRot = Math.cos((args[0] / 180) * Math.PI)\n      yRot = Math.sin((args[0] / 180) * Math.PI)\n      const xs = points.map(p => p[0])\n      const ys = points.map(p => p[1])\n      midX = (Math.min.apply(Math, xs) + Math.max.apply(Math, xs)) / 2\n      midY = (Math.min.apply(Math, ys) + Math.max.apply(Math, ys)) / 2\n      newPoints = points.map(p => [\n        (p[0] - midX) * xRot - (p[1] - midY) * yRot + midX,\n        (p[0] - midX) * yRot + (p[1] - midY) * xRot + midY\n      ])\n      c = args[1]\n      break\n    case 3:\n      throw Error('`polyStroke` found 3 arguments instead of 2, 3, or 5.')\n    default:\n      // polyStroke(points, rotate, x, y, color)\n      xRot = Math.cos((args[0] / 180) * Math.PI)\n      yRot = Math.sin((args[0] / 180) * Math.PI)\n      midX = args[1]\n      midY = args[2]\n      c = args[3]\n      newPoints = points.map(p => [\n        (p[0] - midX) * xRot - (p[1] - midY) * yRot + midX,\n        (p[0] - midX) * yRot + (p[1] - midY) * xRot + midY\n      ])\n      break\n  }\n  for (let i = 1; i < points.length; i++) {\n    line(\n      Math.round(newPoints[i - 1][0]), // x1\n      Math.round(newPoints[i - 1][1]), // y1\n      Math.round(newPoints[i][0]), // x2\n      Math.round(newPoints[i][1]), // y2\n      c\n    )\n  }\n  line(\n    Math.round(newPoints[newPoints.length - 1][0]), // x1\n    Math.round(newPoints[newPoints.length - 1][1]), // y1\n    Math.round(newPoints[0][0]), // x2\n    Math.round(newPoints[0][1]), // y2\n    c\n  )\n}\n\nexport default drawPolyStroke\n","const drawCircle = ({ cx, cy, radius, color, onlyStroke, setPixel, line }) => {\n  let x = radius - 1\n  let y = 0\n  let dx = 1\n  let dy = 1\n  let err = dx - (radius << 1)\n\n  // Draw the correct primitive at x offset from the center, and y above and below the center\n  // If onlyStroke, then draw two points\n  // otherwise, draw a line connecting the two points\n  const drawReflectedPair = (x, y) => {\n    if (onlyStroke) {\n      setPixel(cx + x, cy + y, color)\n      setPixel(cx + x, cy - y, color)\n    } else {\n      line(cx + x, cy + y, cx + x, cy - y, color)\n    }\n  }\n\n  if (radius === 2) {\n    // Draw Left Pixel\n    drawReflectedPair(-1, 0)\n    // Draw Top and Bottom Pixels\n    drawReflectedPair(0, 1)\n    // Draw Right Pixel\n    drawReflectedPair(1, 0)\n  } else if (radius === 3) {\n    // Draw Left Edge\n    drawReflectedPair(-2, 0)\n    drawReflectedPair(-2, 1)\n    // Draw Top and Bottom Edge\n    drawReflectedPair(-1, 2)\n    drawReflectedPair(-0, 2)\n    drawReflectedPair(1, 2)\n    // Draw Right Edge\n    drawReflectedPair(2, 1)\n    drawReflectedPair(2, 0)\n  } else {\n    while (x >= y) {\n      // Draw every octant\n      drawReflectedPair(x, y)\n      drawReflectedPair(-x, y)\n      drawReflectedPair(y, x)\n      drawReflectedPair(-y, x)\n\n      if (err <= 0) {\n        y++\n        err += dy\n        dy += 2\n      }\n\n      if (err > 0) {\n        x--\n        dx += 2\n        err += dx - (radius << 1)\n      }\n    }\n  }\n\n}\n\nexport default drawCircle\n","import clamp from 'lodash/clamp'\n\nconst drawSprite = ({ x, y, spriteIndex, darken, flipH, flipV, setPixel, sprites }) => {\n  if (sprites[spriteIndex]) {\n    sprites[spriteIndex].slice(0, 8).forEach((cells, rowIndex) => {\n      cells.split('').forEach((color, colIndex) => {\n        if (color !== ' ') {\n          const clamped = clamp(+color - darken, 0, 7)\n          setPixel(\n            Math.floor(x) + (flipH ? 7 - colIndex : colIndex),\n            Math.floor(y) + (flipV ? 7 - rowIndex : rowIndex),\n            clamped)\n        }\n      })\n    })\n  }\n}\n\nexport default drawSprite\n","const alphabet = {\n  '<': [\n    0, 0, 1,\n    0, 1, 0,\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n  '>': [\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1,\n    0, 1, 0,\n    1, 0, 0,\n    0, 0, 0,\n  ],\n  '/': [\n    0, 0, 0,\n    0, 0, 1,\n    0, 1, 0,\n    0, 1, 0,\n    1, 0, 0,\n    0, 0, 0,\n  ],\n  ':': [\n    0, 0, 0,\n    0, 0, 0,\n    0, 1, 0,\n    0, 0, 0,\n    0, 1, 0,\n    0, 0, 0,\n  ],\n  '|': [\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 0, 0,\n  ],\n  '(': [\n    0, 1,\n    1, 0,\n    1, 0,\n    1, 0,\n    0, 1,\n    0, 0,\n  ],\n  ')': [\n    1, 0,\n    0, 1,\n    0, 1,\n    0, 1,\n    1, 0,\n    0, 0,\n  ],\n  0: [\n    0, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  1: [\n    1, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  2: [\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  3: [\n    1, 1, 1,\n    0, 0, 1,\n    0, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  4: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n  5: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  6: [\n    1, 0, 0,\n    1, 0, 0,\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  7: [\n    1, 1, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n  8: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0,\n  ],\n  9: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 0,\n  ],\n\n  ' ': [\n    0, 0,\n    0, 0,\n    0, 0,\n    0, 0,\n    0, 0,\n    0, 0\n  ],\n  '.': [\n    0,\n    0,\n    0,\n    0,\n    1,\n    0,\n  ],\n  ',': [\n    0,\n    0,\n    0,\n    0,\n    1,\n    1,\n  ],\n  '+': [\n    0, 0, 0,\n    0, 1, 0,\n    1, 1, 1,\n    0, 1, 0,\n    0, 0, 0,\n    0, 0, 0\n  ],\n  '-': [\n    0, 0, 0,\n    0, 0, 0,\n    1, 1, 1,\n    0, 0, 0,\n    0, 0, 0,\n    0, 0, 0\n  ],\n  '!': [\n    1,\n    1,\n    1,\n    0,\n    1,\n    0,\n  ],\n  '?': [\n    1, 1,\n    0, 1,\n    1, 1,\n    0, 0,\n    1, 0,\n    0, 0,\n  ],\n  a: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  b: [\n    1, 1, 0,\n    1, 0, 1,\n    1, 1, 0,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  c: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 0,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  d: [\n    1, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  e: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  f: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 0,\n    0, 0, 0\n  ],\n  g: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  h: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  i: [\n    1, 1, 1,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  j: [\n    0, 0, 1,\n    0, 0, 1,\n    0, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  k: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  l: [\n    1, 0, 0,\n    1, 0, 0,\n    1, 0, 0,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  m: [\n    1, 0, 1,\n    1, 1, 1,\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  n: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  o: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  p: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 0, 0,\n    1, 0, 0,\n    0, 0, 0\n  ],\n  q: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    0, 1, 1,\n    0, 0, 0\n  ],\n  r: [\n    1, 1, 1,\n    1, 0, 1,\n    1, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  s: [\n    1, 1, 1,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  t: [\n    1, 1, 1,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 1, 0,\n    0, 0, 0\n  ],\n  u: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  v: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 0,\n    0, 0, 0\n  ],\n  w: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    1, 1, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  x: [\n    1, 0, 1,\n    1, 0, 1,\n    0, 1, 0,\n    1, 0, 1,\n    1, 0, 1,\n    0, 0, 0\n  ],\n  y: [\n    1, 0, 1,\n    1, 0, 1,\n    1, 1, 1,\n    0, 0, 1,\n    1, 1, 1,\n    0, 0, 0\n  ],\n  z: [\n    1, 1, 1,\n    0, 0, 1,\n    0, 1, 0,\n    1, 0, 0,\n    1, 1, 1,\n    0, 0, 0\n  ],\n}\n\nexport default alphabet\n","import alphabet from './alphabet.js'\n\nconst drawText = ({ x, y, letters, c, setPixel }) => {\n  let currentX = Math.floor(x)\n  let currentY = Math.floor(y)\n\n  // Loop over every letter in the string to print.\n  for (let letter of letters.toString().split('')) {\n    // Lookup the pixels for the given letter.\n    const pixels = alphabet[letter.toLowerCase()]\n    // If we don't have any pixels, then treat this character as a space which\n    // is 3 pixels wide and continue to the next character.\n    if (!pixels) {\n      currentX += 3 // Couldn't find a character\n      continue\n    }\n\n    // Calculate the letter width by dividing the pixel count\n    // by the standard letter height of 6.\n    let letterWidth = pixels.length / 6\n\n    // Loop over every pixel and draw it to the screen.\n    for (let x = 0; x < letterWidth; x++) {\n      for (let y = 0; y < 6; y++) {\n        if (pixels[y * letterWidth + x]) {\n          setPixel(currentX + x, currentY + y, c)\n        }\n      }\n    }\n\n    // Move on to the next character position by moving the previous character\n    // width plus 1 for a slight space between characters.\n    currentX += letterWidth + 1\n  }\n}\n\nexport default drawText\n","import { get } from 'lodash'\nimport colors from '../colors.js'\nimport drawLine from './line.js'\nimport drawPolyStroke from './polyStroke.js'\nimport { drawRectStroke, drawRectFill } from './rect.js'\nimport drawCircle from './circle.js'\nimport drawSprite from './sprite.js'\nimport drawText from './print.js'\n\nconst backgroundColor = 7\n\n// This function is used in the hover highlight functionality. It is stored on the user inaccessible _script8 global\n// variable and takes as argument a lambda wrapping some user expression. The flag `shouldHighlight` is then set to true\n// while the passed in code is running and returned to false when it finishes. `shouldHighlight` is used to modify\n// colors while true to indicate to the user how a given function call effects the drawing on the screen\nexport let shouldHighlight = false\nexport const injectHighlight = (code) => {\n  shouldHighlight  = true\n  let result = code()\n  shouldHighlight = false\n  return result\n}\n\nconst canvasAPI = ({\n  pixels,\n  width: canvasWidth,\n  height: canvasHeight,\n  sprites,\n  // Rename to initialMap, since we have a function named map.\n  map: initialMap = []\n}) => {\n\n  let _runningMap = JSON.parse(JSON.stringify(initialMap))\n  let _cameraX = 0\n  let _cameraY = 0\n  let _colorSwaps = {}\n\n  const camera = (x = 0, y = 0) => {\n    _cameraX = Math.floor(x)\n    _cameraY = Math.floor(y)\n  }\n\n  const clear = (c = 7) => {\n    pixels.fill(colors.int(c))\n  }\n\n  const colorSwap = (from, to) => {\n    if (from === undefined && to === undefined) {\n      _colorSwaps = {}\n    } else {\n      _colorSwaps[colors.int(from)] = colors.int(to)\n    }\n  }\n\n  const setPixel = (x, y, c = 0) => {\n    x = Math.floor(x - _cameraX)\n    y = Math.floor(y - _cameraY)\n    if (x < 0 || x >= canvasWidth || y < 0 || y >= canvasHeight) return\n    const int = colors.int(c)\n    if (int) {\n      const newColor = _colorSwaps[int] || int\n      pixels[y * canvasWidth + x] = newColor\n    }\n  }\n\n  const getPixel = (x, y) => {\n    x = Math.floor(x - _cameraX)\n    y = Math.floor(y - _cameraY)\n    if (x < 0 || x >= canvasWidth || y < 0 || y >= canvasHeight)\n      return backgroundColor\n    return colors.lookupInt(pixels[y * canvasHeight + x])\n  }\n\n  const line = (x1, y1, x2, y2, c = 0) => {\n    drawLine({ x1, y1, x2, y2, setPixel, color: c })\n  }\n\n  const polyStroke = (points, ...args) => {\n    drawPolyStroke({ points, args, line })\n  }\n\n  const rectStroke = (x, y, w, h, c = 0) => {\n    drawRectStroke({\n      x,\n      y,\n      w,\n      h,\n      c,\n      line\n    })\n  }\n\n  const rectFill = (x, y, w, h, c = 0) => {\n    drawRectFill({\n      x,\n      y,\n      w,\n      h,\n      c,\n      line\n    })\n  }\n\n  const circStroke = (x, y, r, c = 0) => {\n    drawCircle({\n      cx: Math.floor(x),\n      cy: Math.floor(y),\n      radius: Math.floor(r),\n      color: c,\n      onlyStroke: true,\n      setPixel,\n      line\n    })\n  }\n\n  const circFill = (x, y, r, c = 0) => {\n    drawCircle({\n      cx: Math.floor(x),\n      cy: Math.floor(y),\n      radius: Math.floor(r),\n      color: c,\n      setPixel,\n      line\n    })\n  }\n\n  const print = (x, y, letters, c = 0) => {\n    drawText({\n      x,\n      y,\n      letters,\n      c,\n      setPixel\n    })\n  }\n\n  const sprite = (\n    x,\n    y,\n    spriteIndex,\n    darken = 0,\n    flipH = false,\n    flipV = false\n  ) => {\n    if (x - _cameraX < -8 || x - _cameraX > canvasWidth) return\n    if (y - _cameraY < -8 || y - _cameraY > canvasHeight) return\n\n    drawSprite({\n      x,\n      y,\n      spriteIndex,\n      darken,\n      flipH,\n      flipV,\n      setPixel,\n      sprites\n    })\n  }\n\n  const getTile = (mx, my) => {\n    const tile = get(_runningMap, [my, mx], null)\n    const result = tile !== null ? sprites[tile] : null\n    if (result) {\n      result.type = result[8] || 0\n      result.number = tile\n    }\n    return result\n  }\n\n  const setTile = (mx, my, spriteNumber) => {\n    _runningMap[my][mx] = spriteNumber\n  }\n\n  const map = (x = 0, y = 0) => {\n    // Loop over every element in the map\n    _runningMap.forEach((row, rowNumber) => {\n      row.forEach((spriteIndex, colNumber) => {\n        // If the element has a sprite index,\n        if (spriteIndex !== null) {\n          // Render at the correct offset position\n          const dx = (colNumber + x) * 8\n          const dy = (rowNumber + y) * 8\n          sprite(dx, dy, spriteIndex)\n        }\n      })\n    })\n  }\n\n  const resetMap = () => {\n    _runningMap = JSON.parse(JSON.stringify(initialMap))\n  }\n\n  return {\n    camera,\n    clear,\n    colorSwap,\n    setPixel,\n    getPixel,\n    line,\n    polyStroke,\n    rectStroke,\n    rectFill,\n    circStroke,\n    circFill,\n    print,\n    sprite,\n    getTile,\n    setTile,\n    map,\n    resetMap\n  }\n}\n\nexport default canvasAPI\n","export const drawRectStroke = ({ x, y, w, h, c, line }) => {\n  let left = Math.floor(x)\n  let right = Math.floor(x + w - 1)\n  let top = Math.floor(y)\n  let bottom = Math.floor(y + h - 1)\n  line(left, top, right, top, c)\n  line(left, bottom, right, bottom, c)\n  line(left, top, left, bottom, c)\n  line(right, top, right, bottom, c)\n}\n\nexport const drawRectFill = ({ x, y, w, h, c, line }) => {\n  let left = Math.floor(x)\n  let right = Math.floor(x + w - 1)\n  let top = Math.floor(y)\n  let bottom = Math.floor(y + h - 1)\n\n  for (let rectX = left; rectX <= right; rectX++) {\n    line(rectX, top, rectX, bottom, c)\n  }\n}\n","const runningSum = array => {\n  if (!array.length) array.push(0)\n  return array.reduce((acc, cur, idx) => {\n    if (idx > 0) {\n      const previous = acc[idx - 1]\n      return [...acc, [previous[1], previous[1] + cur]]\n    } else {\n      return [[0, cur]]\n    }\n  }, [])\n}\n\nexport default runningSum\n","import _ from 'lodash'\nimport runningSum from '../utils/runningSum.js'\n\n// This takes a tab and returns the code from that tab. It also looks at the call expression under the mouse (if one\n// exists) and wraps it in the `_script8.injectHighlight` function to setup higlighting. Decorate is taken as an\n// argument so that places which do not need decorated code can preserve the code as written by the user.\nconst decorateTabCode = (tab, decorate) => {\n  if (tab.callUnderMouse && tab.text && decorate) {\n    // Say the user has written the following code:\n    //\n    //     drawTitle = () => {\n    //       print(64, 64, \"Crazy Awesome Game!\")\n    //       return true\n    //     }\n    //\n    //     if (drawTitle()) { ... do something ... }\n    //         ^^^^^^^^^^^\n    // With the mouse hovering over the drawTitle call. In this case, the `callUnderMouse` for the current tab would be\n    // a callExpression node with a `callee` of the drawTitle Identifier, and an empty arguments list. We can hook into\n    // this call by wrapping it in a lambda and passing it to a function which sets the highlight flag before and after\n    // making the drawTitle call. In our case we have stored a special `injectHighlight` function in the _script8\n    // global variable which is unaccessible by the user. The resulting code for that line looks like this:\n    //\n    //     if (_script8.injectHighlight(() => drawTitle())) { ... do something ... }\n    //\n    // Since `injectHighlight` stores and passes on the return value fom the lambda, the wrapped expression can be used\n    // in any place the original expression was used. But we get the added benefit of knowing when the command started\n    // and when it ended\n    let node = tab.callUnderMouse\n    let before = tab.text.slice(0, node.start)\n    let nodeCode = tab.text.slice(node.start, node.end)\n    let after = tab.text.slice(node.end)\n    return `${before}_script8.injectHighlight(() => ${nodeCode})${after}`\n  }\n  return tab.text\n};\n\nconst assembleOrderedGame = (game, decorate = true) =>\n  _(game)\n    .orderBy((value, key) => key)\n    .map(tab => decorateTabCode(tab, decorate))\n    .filter(d => !_.isEmpty(d))\n    .value()\n    .join('\\n')\n\nconst parseGistGame = data => {\n  const misc = JSON.parse(_.get(data, 'files[\"misc.json\"].content', '{}'))\n  const content = _.get(data, 'files[\"code.js\"].content', '')\n  if (misc.lines) {\n    const ranges = runningSum(misc.lines)\n    const contentLines = content.split('\\n')\n    return ranges.reduce(\n      (acc, cur, idx) => ({\n        ...acc,\n        [idx]: {\n          text: contentLines.slice(...cur).join('\\n'),\n          active: idx === 0,\n          key: idx\n        }\n      }),\n      {}\n    )\n  } else {\n    return {\n      0: {\n        text: content,\n        active: true,\n        key: 0\n      }\n    }\n  }\n}\n\nexport { parseGistGame, assembleOrderedGame }\n","import React, { Component } from 'react'\nimport classNames from 'classnames'\nimport equal from 'deep-equal'\nimport * as Tone from 'tone'\nimport { interval } from 'd3-timer'\nimport { createStore, applyMiddleware } from 'redux'\nimport _ from 'lodash'\nimport sum from 'lodash/sum'\nimport range from 'lodash/range'\nimport flatten from 'lodash/flatten'\nimport random from 'lodash/random'\nimport clamp from 'lodash/clamp'\nimport once from 'lodash/once'\nimport uniqBy from 'lodash/uniqBy'\nimport isEmpty from 'lodash/isEmpty'\nimport chunk from 'lodash/chunk'\nimport bios from './utils/bios.js'\nimport StateMachine from 'javascript-state-machine'\nimport soundAPI from './soundAPI/index.js'\nimport {\n  default as frameBufferCanvasAPI,\n  injectHighlight\n} from './frameBufferCanvasAPI/index.js'\nimport pixelData from './frameBufferCanvasAPI/pixelData.js'\nimport trimCanvas from './contextCanvasAPI/trimCanvas.js'\nimport validateToken from './validateToken.js'\nimport getUserInput, { allowedKeys } from './getUserInput.js'\nimport createReducer from './createReducer.js'\nimport skeleton from './skeleton.js'\nimport { extractGistMap } from './gistParsers/map.js'\nimport { extractGistSprites } from './gistParsers/sprites.js'\nimport { extractGistPhrases } from './gistParsers/phrases.js'\nimport { extractGistChains } from './gistParsers/chains.js'\nimport { extractGistSongs } from './gistParsers/songs.js'\nimport { parseGistGame, assembleOrderedGame } from './gistParsers/game.js'\nimport { getEvaledErrorPosition } from './utils/errorLocation.js'\nimport './css/Iframe.css'\nimport { version } from '../package.json'\n\n// window.SCRIPT_8_EMBEDDED_GIST_ID = 'd5dacf8f639a775996c4ed9f9156d4d5'\n\n// Get the browser platform.\nconst { platform } = window.navigator\n\n// Print the SCRIPT-8 iframe version to the console.\nconsole.log(JSON.stringify(`SCRIPT-8 iframe v ${version}`, null, 2))\n\n// This function takes an object of errors, keyed by type, and converts them\n// to an array of objects with properties { type, data },\n// filters down to errors that have both type and data,\n// sorts by type,\n// and only keeps those with unique data.\nconst getUniqueErrorMessages = errors =>\n  _(errors)\n    .map((data, type) => ({ type, data }))\n    .filter(d => d.data && d.type)\n    .sortBy('type')\n    .uniqBy(d => JSON.stringify(d.data))\n    .value()\n\n// These four are part of the SCRIPT-8 API.\nwindow.init = null\nwindow.update = null\nwindow.drawActors = null\nwindow.draw = null\n\n// Create window-scoped variables under the _script8 object.\n// This key will be passed to a validation function,\n// to prevent the user from using them.\nwindow._script8 = {\n  embedState: {},\n  reservedTokens: new Set(['init', 'update', 'drawActors', 'draw']),\n  injectHighlight\n}\n\n// Convenience function.\nconst NOOP = () => {}\n\n// Use this to set SCRIPT-8's desired FPS.\nconst FPS = 60\n\n// Use this to set how far in the past we want to rewind.\nconst REDUX_HISTORY_SECONDS = 2\n\n// Convenience constant placeholder for 128. Theoretically this could enable\n// us to adjust the canvas size, but in reality this will never happen.\nconst CANVAS_SIZE = 128\n\n// Number of frames to skip when drawing an actor's past. If we were to draw\n// every single frame, we wouldn't be able to distinguish the actor's trail.\nconst ACTOR_FRAME_SKIP = 5\n\nclass Iframe extends Component {\n  constructor(props) {\n    super(props)\n\n    // The following ref-binding functions set up keyboard listeners.\n    this.ArrowUpElement = null\n    this.setArrowUpRef = e => {\n      this.ArrowUpElement = e\n    }\n    this.ArrowRightElement = null\n    this.setArrowRightRef = e => {\n      this.ArrowRightElement = e\n    }\n    this.ArrowDownElement = null\n    this.setArrowDownRef = e => {\n      this.ArrowDownElement = e\n    }\n    this.ArrowLeftElement = null\n    this.setArrowLeftRef = e => {\n      this.ArrowLeftElement = e\n    }\n    this.aElement = null\n    this.setaRef = e => {\n      this.aElement = e\n    }\n    this.bElement = null\n    this.setbRef = e => {\n      this.bElement = e\n    }\n    this.EnterElement = null\n    this.setEnterRef = e => {\n      this.EnterElement = e\n    }\n    this.SpaceElement = null\n    this.setSpaceRef = e => {\n      this.SpaceElement = e\n    }\n\n    this.touchstartArrowUp = this.touchstartArrowUp.bind(this)\n    this.touchstartArrowRight = this.touchstartArrowRight.bind(this)\n    this.touchstartArrowDown = this.touchstartArrowDown.bind(this)\n    this.touchstartArrowLeft = this.touchstartArrowLeft.bind(this)\n    this.touchstarta = this.touchstarta.bind(this)\n    this.touchstartb = this.touchstartb.bind(this)\n    this.touchstartEnter = this.touchstartEnter.bind(this)\n    this.touchstartSpace = this.touchstartSpace.bind(this)\n\n    this.touchendArrowUp = this.touchendArrowUp.bind(this)\n    this.touchendArrowRight = this.touchendArrowRight.bind(this)\n    this.touchendArrowDown = this.touchendArrowDown.bind(this)\n    this.touchendArrowLeft = this.touchendArrowLeft.bind(this)\n    this.touchenda = this.touchenda.bind(this)\n    this.touchendb = this.touchendb.bind(this)\n    this.touchendEnter = this.touchendEnter.bind(this)\n    this.touchendSpace = this.touchendSpace.bind(this)\n\n    this.addLog = this.addLog.bind(this)\n    this.sendLogsToParent = this.sendLogsToParent.bind(this)\n    this.logs = []\n    this.sendErrorToParent = this.sendErrorToParent.bind(this)\n    this.loggerErrors = {}\n    this.printErrorsToCassetteScreen = this.printErrorsToCassetteScreen.bind(\n      this\n    )\n\n    this.updateGlobals = this.updateGlobals.bind(this)\n    this.evalCode = this.evalCode.bind(this)\n    this.startTimer = this.startTimer.bind(this)\n    this.handleTimelineInput = this.handleTimelineInput.bind(this)\n    this.handleActorClick = this.handleActorClick.bind(this)\n    this.handlePauseClick = this.handlePauseClick.bind(this)\n    this.handleRestartClick = this.handleRestartClick.bind(this)\n\n    this.heightSent = 0\n\n    this.shadows = new Set(['document'])\n    this.blacklist = new Set(['eval', 'alert', '_script8'])\n    this.keys = new Set()\n\n    this.timer = null\n    this.previousElapsed = 0\n    this.pastFpsValues = []\n\n    this.volumeNode = new Tone.Volume()\n\n    this.reducer = createReducer(this.sendErrorToParent)\n    this.store = null\n    this.previousInitString = null\n    this.reduxHistory = []\n    this.reduxLogger = store => next => action => {\n      // Add this state and action to history,\n      // and limit it to the 3 seconds worth of entries.\n      // We calculate this by using fps.\n      this.reduxHistory = [\n        ...this.reduxHistory,\n        {\n          state: store.getState(),\n          action\n        }\n      ].slice(-(FPS * REDUX_HISTORY_SECONDS))\n\n      return next(action)\n    }\n\n    this.soundFunctions = null\n    this.songSequences = null\n\n    this.state = {\n      started: false,\n      fps: null,\n      game: '',\n      sprites: {},\n      map: {},\n      songs: {},\n      chains: {},\n      phrases: {},\n      timelineIndex: 0,\n      actors: [],\n      selectedActors: [],\n      message: null,\n      callbacks: {},\n      isPaused: false,\n      alteredStates: [],\n      // NOTE: Output.js defines this as:\n      //   run: [screenTypes.BOOT, screenTypes.RUN].includes(screen)\n      run: true,\n      sound: true,\n      isTouchScreen: false\n    }\n\n    this._pixelData = pixelData({ width: CANVAS_SIZE, height: CANVAS_SIZE })\n  }\n\n  // The following event listeners add/remove css classes from the DOM elements,\n  // and also add/remove keys from the input object.\n  touchstartArrowUp() {\n    this.ArrowUpElement.classList.add('on')\n    this.keys.add('ArrowUp')\n  }\n  touchstartArrowRight() {\n    this.ArrowRightElement.classList.add('on')\n    this.keys.add('ArrowRight')\n  }\n  touchstartArrowDown() {\n    this.ArrowDownElement.classList.add('on')\n    this.keys.add('ArrowDown')\n  }\n  touchstartArrowLeft() {\n    this.ArrowLeftElement.classList.add('on')\n    this.keys.add('ArrowLeft')\n  }\n  touchstarta() {\n    this.aElement.classList.add('on')\n    this.keys.add('a')\n  }\n  touchstartb() {\n    this.bElement.classList.add('on')\n    this.keys.add('b')\n  }\n  touchstartEnter() {\n    this.EnterElement.classList.add('on')\n    this.keys.add('Enter')\n  }\n  touchstartSpace() {\n    this.SpaceElement.classList.add('on')\n    this.keys.add(' ')\n  }\n\n  touchendArrowUp() {\n    this.ArrowUpElement.classList.remove('on')\n    this.keys.delete('ArrowUp')\n  }\n  touchendArrowRight() {\n    this.ArrowRightElement.classList.remove('on')\n    this.keys.delete('ArrowRight')\n  }\n  touchendArrowDown() {\n    this.ArrowDownElement.classList.remove('on')\n    this.keys.delete('ArrowDown')\n  }\n  touchendArrowLeft() {\n    this.ArrowLeftElement.classList.remove('on')\n    this.keys.delete('ArrowLeft')\n  }\n  touchenda() {\n    this.aElement.classList.remove('on')\n    this.keys.delete('a')\n  }\n  touchendb() {\n    this.bElement.classList.remove('on')\n    this.keys.delete('b')\n  }\n  touchendEnter() {\n    this.EnterElement.classList.remove('on')\n    this.keys.delete('Enter')\n  }\n  touchendSpace() {\n    this.SpaceElement.classList.remove('on')\n    this.keys.delete(' ')\n  }\n\n  sendLogsToParent() {\n    if (!this.isEmbed) {\n      const { message, run } = this.state\n      if (!run) {\n        message.ports[0].postMessage({\n          logs: this.logs\n        })\n      }\n    }\n    this.logs = []\n  }\n\n  // Add log to logs array.\n  addLog(value) {\n    // Also print to console.\n    // Don't use if we're on embed mode.\n    if (!this.isEmbed) {\n      const { run } = this.state\n      // If we have something to log,\n      if (!run && !_.isNil(value)) {\n        // update the logs.\n        this.logs.push(value)\n      }\n    }\n  }\n\n  // Send error message to parent,\n  // and if in RUN mode, print it to cassette screen.\n  sendErrorToParent({ type, error = null }) {\n    const { message, run } = this.state\n    // If we have an error,\n    if (error) {\n      const errorData = {\n        message: error.message,\n        position: getEvaledErrorPosition(error)\n      }\n\n      if (errorData.message.startsWith('enhancer(...) is not a function')) {\n        errorData.message = 'The init or update functions are invalid.'\n      }\n\n      // and it is different than the previous one,\n      if (\n        JSON.stringify(this.loggerErrors[type]) !== JSON.stringify(errorData)\n      ) {\n        // update the loggerErrors,\n        this.loggerErrors[type] = errorData\n        // and send to parent.\n        if (!this.isEmbed) {\n          message.ports[0].postMessage({\n            errors: getUniqueErrorMessages(this.loggerErrors)\n          })\n        }\n      }\n    } else {\n      // If we don't have an error, and we had one before,\n      if (this.loggerErrors[type]) {\n        // update the loggerErrors for this type,\n        this.loggerErrors[type] = null\n        // and send to parent.\n        if (!this.isEmbed) {\n          message.ports[0].postMessage({\n            errors: getUniqueErrorMessages(this.loggerErrors)\n          })\n        }\n      }\n    }\n\n    // If we're on run mode,\n    if (run) {\n      this.printErrorsToCassetteScreen()\n    }\n  }\n\n  // Print errors to cassette screen.\n  printErrorsToCassetteScreen() {\n    // Create one string with all the unique error messages.\n    const errorMessages = getUniqueErrorMessages(this.loggerErrors)\n      .map(error => `error: ${error.data.message}`)\n      .join('. ')\n\n    if (errorMessages.length) {\n      // Print the error message in black, offset.\n      chunk(errorMessages, 32).forEach((errorMessage, i) => {\n        const theString = errorMessage.join('')\n        range(3).forEach(x => {\n          range(3).forEach(y => {\n            window.print(1 + x, 1 + y + i * 8, theString, 7)\n          })\n        })\n        // Now print the error message in white.\n        window.print(2, 2 + i * 8, theString, 0)\n      })\n\n      this.writePixelDataToCanvas()\n    }\n  }\n\n  // Assign various properties to global scope, for the user.\n  // Also add them to the list of reserved tokens.\n  updateGlobals(providedGlobals) {\n    let globals\n\n    if (!providedGlobals) {\n      const canvasAPI = frameBufferCanvasAPI\n\n      globals = {\n        console,\n        StateMachine,\n        JSON,\n        Math,\n        Object,\n        Array,\n        log: this.addLog,\n        ...canvasAPI({\n          pixels: this._pixelData.pixels,\n          ctx: this._canvas.getContext('2d'),\n          width: CANVAS_SIZE,\n          height: CANVAS_SIZE,\n          sprites: this.state.sprites,\n          map: this.state.map\n        }),\n        range,\n        flatten,\n        random,\n        clamp\n      }\n    } else {\n      globals = providedGlobals\n    }\n\n    // For each global key,\n    Object.keys(globals).forEach(key => {\n      // assign the corresponding global object to window,\n      window[key] = globals[key]\n\n      // and add the key to the list of reserved tokens.\n      window._script8.reservedTokens.add(key)\n    })\n  }\n\n  // Writes pixel data buffer to canvas.\n  writePixelDataToCanvas() {\n    this._pixelData.writePixelDataToCanvas(this._canvas.getContext('2d'))\n  }\n\n  // Calls window.draw(state) .\n  // Works with either context or frame buffer renderer.\n  drawUserGraphics(state) {\n    if (window.draw) {\n      window.draw(state)\n      this.writePixelDataToCanvas()\n    }\n  }\n\n  componentDidMount() {\n    // Initialize sound API with this Tone.js volumeNode.\n    this.soundFunctions = soundAPI(this.volumeNode)\n\n    // Update globals with sound API functions.\n    this.updateGlobals({\n      playPhrase: this.soundFunctions.playPhrase,\n      playChain: this.soundFunctions.playChain,\n      stopChain: this.soundFunctions.stopChain,\n      playSong: this.soundFunctions.playSong,\n      stopSong: this.soundFunctions.stopSong\n    })\n\n    // Listen for mouse down / up events.\n    this.mousedownHandler = () => {\n      this.keys.add('mousedown')\n    }\n    this.mouseupHandler = () => {\n      this.keys.delete('mousedown')\n    }\n\n    // Listen for key down events.\n    this.keydownHandler = event => {\n      // Listen for record cassette and go to previous/next screen,\n      // and send them to parent.\n      const { altKey, metaKey, ctrlKey, key, code } = event\n      const { message } = this.state\n\n      // Listen to Ctrl-s / Cmd-s.\n      if (\n        (!this.isEmbed &&\n          (metaKey && code === 'KeyS' && _.includes(platform, 'Mac'))) ||\n        (ctrlKey && code === 'KeyS' && !_.includes(platform, 'Mac'))\n      ) {\n        event.preventDefault()\n        message.ports[0].postMessage({\n          shortcut: 'save'\n        })\n      }\n\n      // Listen Alt-. / Alt-/ .\n      if (!this.isEmbed && altKey) {\n        if (code === 'Period') {\n          event.preventDefault()\n          message.ports[0].postMessage({\n            shortcut: 'previous'\n          })\n        }\n        if (code === 'Slash') {\n          event.preventDefault()\n          message.ports[0].postMessage({\n            shortcut: 'next'\n          })\n        }\n      }\n\n      // If we pressed an allowed key, e.g. up, down, a, etc,\n      if (allowedKeys.includes(key)) {\n        // don't let it bubble up to the parent.\n        // The inverse of this means that something like Ctrl-R (reload on windows)\n        // will be indeed allowed to bubble up.\n        event.preventDefault()\n        event.stopPropagation()\n      }\n\n      // Finally, add the keyDown to the keys object.\n      this.keys.add(key)\n    }\n    this.keyupHandler = event => {\n      // Only handle the keys we want. Same as above.\n      const { key } = event\n      if (allowedKeys.includes(key)) {\n        event.preventDefault()\n        event.stopPropagation()\n      }\n      this.keys.delete(key)\n    }\n\n    // Add touch / mouse / key event handlers.\n    document.addEventListener('touchstart', () => {\n      this.setState({\n        isTouchScreen: true\n      })\n      this.mousedownHandler()\n    })\n    document.addEventListener('mousedown', this.mousedownHandler)\n    document.addEventListener('touchend', this.mouseupHandler)\n    document.addEventListener('mouseup', this.mouseupHandler)\n    document.addEventListener('keydown', this.keydownHandler)\n    document.addEventListener('keyup', this.keyupHandler)\n\n    // Listen for `callCode`, `findInvalidToken`, or `image` messages.\n    // `callCode` can come from either the parent\n    // or from here, if we're in embed mode.\n    // The other two will come from the parent.\n    const handleData = message => {\n      const { type, ...payload } = message.data\n      const { blacklist, shadows } = this\n\n      if (\n        // If the message is of type callCode,\n        // it means we are getting new game data (e.g. code, sprites, etc).\n        type === 'callCode'\n      ) {\n        // Finally, set this react state with payload data,\n        // and also add the message.\n        this.setState({\n          ...payload,\n          message\n        })\n      } else if (\n        // If we're trying to find an invalid token,\n        type === 'findInvalidToken'\n      ) {\n        // Find the first invalid token in the provided tokens array,\n        const invalidTokenIndex = payload.tokens.findIndex(\n          token =>\n            !validateToken({\n              token,\n              blacklist,\n              globals: window._script8.reservedTokens,\n              shadows\n            })\n        )\n        // and if found, send to parent.\n        message.ports[0].postMessage(invalidTokenIndex)\n      } else if (\n        // If we want an image, e.g. the parent wants a cassette screenshot,\n        type === 'image'\n      ) {\n        // create a temporary canvas,\n        const smallCanvas = document.createElement('canvas')\n        // set its dimensions,\n        const size = 128\n        smallCanvas.width = size\n        smallCanvas.height = size\n        // draw onto it the pixels from the main canvas,\n        smallCanvas.getContext('2d').drawImage(this._canvas, 0, 0, size, size)\n        // and send the dataURL to the parent.\n        message.ports[0].postMessage(smallCanvas.toDataURL())\n      }\n    }\n\n    // If there's an id in the embed,\n    if (window.SCRIPT_8_EMBEDDED_GIST_ID) {\n      // set the isEmbed flag,\n      this.isEmbed = true\n      // and try fetching the gist.\n      window\n        .fetch(\n          `${process.env.REACT_APP_NOW}/gist/${window.SCRIPT_8_EMBEDDED_GIST_ID}`\n        )\n        .then(response => response.json())\n        .then(json => {\n          // Then, parse the gist, and send data to `handleData`,\n          // which starts the game.\n          this.gist = json\n          handleData({\n            data: {\n              type: 'callCode',\n              game: bios,\n              isDoneFetching: true,\n              songs: extractGistSongs(json),\n              chains: extractGistChains(json),\n              phrases: extractGistPhrases(json),\n              sprites: extractGistSprites(json),\n              map: extractGistMap(json),\n              run: true,\n              callbacks: {},\n              sound: true\n            }\n          })\n        })\n    } else {\n      // Otherwise, wait for messages from parent.\n      window.addEventListener('message', handleData)\n    }\n\n    // Finally, update globals - e.g. set `console`, `range`, the canvasAPI functions, etc\n    // to the global scope for our user.\n    this.updateGlobals()\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('touchstart', this.mousedownHandler)\n    document.removeEventListener('mousedown', this.mousedownHandler)\n    document.removeEventListener('touchend', this.mouseupHandler)\n    document.removeEventListener('mouseup', this.mouseupHandler)\n    document.removeEventListener('keydown', this.keydownHandler)\n    document.removeEventListener('keyup', this.keyupHandler)\n  }\n\n  // Call `eval` on user-supplied code.\n  // TODO: for some reason all usages of this function did this:\n  // evalCode({ ...state, shadows })\n  evalCode() {\n    const { shadows, state } = this\n    // eslint-disable-next-line no-unused-vars\n    const { game, message, callbacks, isDoneFetching } = state\n    try {\n      // If we're done fetching,\n      if (isDoneFetching)\n        // define the following end function, which we can only call once:\n        window._script8.end = once(() => {\n          // when the user calls this (which should only happen once, in bios),\n          this.setState({\n            // assemble the game code,\n            game: assembleOrderedGame(parseGistGame(this.gist)),\n            // and let us know we can show the play/pause buttons.\n            started: true\n          })\n          // If Tone.js is not running,\n          if (Tone.context.state !== 'running') {\n            // start it.\n            // This is allowed because the root event is a click event.\n            Tone.start()\n          }\n          // Then, call the callback once, if we're not in embed mode\n          // (if we're in embed mode, there's no parent to talk to).\n          if (!this.isEmbed) {\n            message.ports[0].postMessage({\n              callback: callbacks.endCallback\n            })\n          }\n        })\n\n      // Save previous init. Why?\n      // Because if it has changed, we take it the user wants to restart\n      // the game. So we will run init again.\n      this.previousInitString = window.init ? window.init.toString() : null\n\n      // Get ready to eval the supplied game:\n\n      // First, create a list of variables we want to shadow.\n      const shadowString = `var ${[...shadows].join(',')}`\n\n      // Declare a locally-scoped variable pointing to skeleton, so we can eval it.\n      // eslint-disable-next-line no-unused-vars\n      const innerSkeleton = skeleton\n\n      // Eval!\n      // eslint-disable-next-line no-eval\n      eval(`\n      // Shadow variables we don't want available.\n      ${shadowString}\n      // The inception eval allows the user to declare vars (e.g. screen).\n      eval(innerSkeleton)\n      eval(game)\n    `)\n\n      // If we got to this point, send a null error to parent.\n      this.sendErrorToParent({ type: 'evalCode' })\n    } catch (e) {\n      // Error! Send it to parent.\n      this.sendErrorToParent({ type: 'evalCode', error: e })\n    }\n  }\n\n  stopTimer() {\n    if (this.timer) {\n      this.timer.stop()\n    }\n  }\n\n  // Start the timer that calls update and draw every tick.\n  startTimer() {\n    // Create a function that d3.interval calls every tick.\n    const timerCallback = elapsed => {\n      // Wrap it in try/catch, since the reducer may throw errors.\n      try {\n        // Calculate the actual FPS by looking at the difference\n        // between now and the last time the tick was called.\n        const tickLength = elapsed - this.previousElapsed\n        const fps = Math.round(1000 / tickLength)\n\n        // Save this fps.\n        this.pastFpsValues.push(fps)\n\n        // Every 60 ticks,\n        // calculate the average FPS for those 60 ticks,\n        // and clear out the pastFpsValues array.\n        let newFps\n        if (this.pastFpsValues.length > 60) {\n          newFps = Math.round(\n            sum(this.pastFpsValues) / this.pastFpsValues.length\n          )\n          this.pastFpsValues = []\n        }\n\n        // Save current elapsed so we can use it next tick to calculate FPS.\n        this.previousElapsed = elapsed\n\n        // Get the user input (keys pressed / released, mouse down / up).\n        const userInput = getUserInput(this.keys)\n\n        // If we're running in embed mode,\n        if (this.isEmbed) {\n          // update the embed state.\n          window.update(window._script8.embedState, userInput, tickLength)\n        } else {\n          // Otherwise update the redux store with the user input and tick length.\n          if (this.store && this.store.dispatch) {\n            this.store.dispatch({\n              type: 'UPDATE',\n              input: userInput,\n              elapsed: tickLength\n            })\n          }\n        }\n\n        // Draw this state.\n        if (this.store && this.store.dispatch) {\n          this.drawUserGraphics(\n            this.isEmbed ? window._script8.embedState : this.store.getState()\n          )\n        }\n\n        // Clear logs after drawing.\n        this.sendLogsToParent()\n\n        // Update fps, only if we had a new measurement.\n        if (newFps !== undefined && newFps !== this.state.fps) {\n          this.setState({\n            fps: newFps\n          })\n        }\n\n        // If we got to this point, send a null error to parent.\n        this.sendErrorToParent({ type: 'startTimer' })\n      } catch (e) {\n        // Error! Send it to parent.\n        this.sendErrorToParent({ type: 'startTimer', error: e })\n      }\n    }\n    // If the timer exists, make sure to stop it first.\n    if (this.timer) {\n      this.timer.stop()\n    }\n    // Clear out previousElapsed before we start the timer.\n    this.previousElapsed = 0\n    // Start the timer at our desired FPS rate.\n    this.timer = interval(timerCallback, 1000 / FPS)\n  }\n\n  handleTimelineInput(e) {\n    this.setState({\n      timelineIndex: +e.target.value\n    })\n  }\n\n  handleActorClick(actorName) {\n    const { selectedActors } = this.state\n\n    // If actorName is in selectedActors, take it out.\n    // Otherwise put it in.\n    const actors = selectedActors.includes(actorName)\n      ? selectedActors.filter(d => d !== actorName)\n      : [...selectedActors, actorName]\n\n    this.setState({\n      selectedActors: actors\n    })\n  }\n\n  handleRestartClick() {\n    // Make init be something unique. This will force it to be reset.\n    window.init = Date.now()\n    // If we're embedded, setting embedState to this string will also force a reset.\n    window._script8.embedState = 'SCRIPT-8-RESTART'\n    this.reduxHistory = []\n    this.pastFpsValues = []\n    this.forceUpdate()\n  }\n\n  handlePauseClick() {\n    if (this.state.isPaused) {\n      this.reduxHistory = []\n      this.startTimer()\n    } else {\n      this.stopTimer()\n    }\n\n    this.setState({\n      selectedActors: [],\n      actors: [],\n      fps: null,\n      isPaused: !this.state.isPaused\n    })\n  }\n\n  // When the app's UI state has changed,\n  componentDidUpdate(prevProps, prevState) {\n    const { state } = this\n    const {\n      message,\n      isPaused,\n      game,\n      sprites,\n      map,\n      timelineIndex,\n      actors,\n      selectedActors,\n      sound,\n      songs,\n      chains,\n      phrases,\n      run\n    } = state\n\n    try {\n      // If the sprites or map have changed, update the globals.\n      if (!equal(sprites, prevState.sprites) || !equal(map, prevState.map)) {\n        this.updateGlobals()\n      }\n\n      // If soundon/soundoff has changed,\n      // toggle volume.\n      // Also resume AudioContext IF it's not running.\n      if (!equal(sound, prevState.sound)) {\n        Tone.Master.mute = !sound\n      }\n\n      // If the music data changed,\n      if (\n        !equal(songs, prevState.songs) ||\n        !equal(chains, prevState.chains) ||\n        !equal(phrases, prevState.phrases)\n      ) {\n        // make sequences,\n        this.soundFunctions.makeSongsAndChains({\n          songs,\n          chains,\n          phrases\n        })\n        // and restart game.\n        this.handleRestartClick()\n      }\n\n      // If we are not on a run screen,\n      if (!run) {\n        // mute the volume node.\n        this.volumeNode.mute = true\n      } else {\n        // If we are on the run screen,\n        // unmute the volume node.\n        this.volumeNode.mute = false\n      }\n\n      // If we're playing, check for two overall scenarios:\n      if (!isPaused) {\n        // 1 - We're embedded.\n        if (this.isEmbed) {\n          // Then, if the game is different,\n          // or the initialState has changed,\n          if (\n            game !== prevState.game ||\n            window._script8.embedState === 'SCRIPT-8-RESTART'\n          ) {\n            // evaluate user code,\n            this.evalCode()\n            // and run init.\n            window._script8.embedState = {}\n            window.init(window._script8.embedState)\n          }\n        } else {\n          // 2 - We're not embedded.\n          // Then, if we came back from being paused,\n          // or the game is different,\n          // or the run mode was different,\n          // or init has changed,\n          if (\n            prevState.isPaused ||\n            game !== prevState.game ||\n            run !== prevState.run ||\n            !equal(\n              window.init ? window.init.toString() : null,\n              this.previousInitString\n            )\n          ) {\n            // evaluate user code,\n            // get redux state,\n            // and create redux store.\n\n            // Evaluate user code.\n            this.evalCode()\n\n            // Before we create a redux store, let's think about what state we want.\n            // If the user has changed init, use that.\n            // This way we let the user start over when they modify init.\n            // This is an escape hatch of sorts.\n            // Otherwise use the current store state. This will enable us to modify game\n            // code and not lose game state.\n            if (\n              !equal(\n                window.init ? window.init.toString() : null,\n                this.previousInitString\n              )\n            ) {\n              // If init has changed, first create the store,\n              this.store = createStore(\n                this.reducer,\n                {},\n                applyMiddleware(this.reduxLogger)\n              )\n              // initialize the game,\n              this.store.dispatch({\n                type: 'INIT'\n              })\n              // and clear out the redux history.\n              this.reduxHistory = []\n            } else {\n              // If init hasn't changed, get the store state,\n              const storeState = (this.store && this.store.getState()) || {}\n              // and create a new store with this state.\n              this.store = createStore(\n                this.reducer,\n                storeState,\n                applyMiddleware(this.reduxLogger)\n              )\n            }\n          }\n        }\n      } else {\n        // If we're not playing,\n        // we can have several different kinds of inputs:\n        // - game has changed\n        // - sprites have changed\n        // - timelineIndex has changed\n        // - selectedActors has changed\n        // Stop the timer (ONLY when pause was clicked).\n        // Evaluate user code (ONLY when game has changed).\n        // Create array of alteredStates (ONLY when game has changed).\n        // Populated list of actor buttons (ONLY when game has changed).\n        // Set timeline length to alteredStates' length (ONLY when pause was clicked).\n        // Set timeline index to max (ONLY when pause was clicked).\n        // Draw the last state, and draw selected actors (highlight timeline index actors).\n\n        // If we're paused,\n        // and either game, timelineIndex, or selectedActors is different:\n        if (\n          !equal(isPaused, prevState.isPaused) ||\n          !equal(game, prevState.game) ||\n          !equal(sprites, prevState.sprites) ||\n          !equal(map, prevState.map) ||\n          !equal(timelineIndex, prevState.timelineIndex) ||\n          !equal(selectedActors, prevState.selectedActors)\n        ) {\n          try {\n            if (this.reduxHistory.length) {\n              // Evaluate user code.\n              this.evalCode()\n\n              // Create the store with the first item in reduxHistory as initial state.\n              // Save that state to alteredStates.\n              // Then, for all next actions in the history, dispatch the action,\n              // and save resulting state to alteredStates.\n              let alteredStates = []\n              this.store = createStore(this.reducer, this.reduxHistory[0].state)\n              alteredStates.push(this.store.getState())\n\n              this.reduxHistory.forEach(({ state, action }, i) => {\n                if (i === timelineIndex - 1) {\n                  // Enable logging only if this is the selected frame.\n                  this.updateGlobals({ log: this.addLog })\n                } else {\n                  this.updateGlobals({ log: NOOP })\n                }\n                this.store.dispatch(action)\n\n                alteredStates.push(this.store.getState())\n              })\n\n              // Re-enable logging.\n              this.updateGlobals({ log: this.addLog })\n\n              alteredStates = alteredStates.filter(d => !isEmpty(d))\n\n              // If we were previously in pause mode,\n              // use the provided timelineIndex.\n              // Otherwise,\n              // set the timeline to the max.\n              const newTimelineIndex = prevState.isPaused\n                ? timelineIndex\n                : alteredStates.length - 1\n\n              // Draw the timeline index state.\n              const stateToDraw = alteredStates[newTimelineIndex]\n              this.drawUserGraphics(stateToDraw)\n\n              // Get all unique actors.\n              const allActors = flatten(\n                alteredStates.map(state => state.actors)\n              ).filter(d => d)\n              const actors = uniqBy(allActors, d => d.id)\n\n              // For each altered state, minus the timeLineIndex one,\n              // draw the actors, if they're selected, faded.\n              alteredStates.forEach((state, i) => {\n                if (\n                  (i !== newTimelineIndex && i % ACTOR_FRAME_SKIP === 0) ||\n                  i === alteredStates.length - 1\n                ) {\n                  const matchingActors =\n                    (state.actors &&\n                      state.actors.filter(d =>\n                        selectedActors.includes(d.id)\n                      )) ||\n                    []\n                  // Disable logging during window.draw calls.\n                  this.updateGlobals({ log: NOOP })\n                  window.drawActors &&\n                    window.drawActors({ actors: matchingActors }, true)\n                  // Re-enable console.log.\n                  this.updateGlobals({ log: this.addLog })\n                }\n              })\n\n              // Draw the timeLineIndex one last, not faded.\n              const lastAlteredState = alteredStates[newTimelineIndex]\n              if (\n                window.drawActors &&\n                lastAlteredState &&\n                lastAlteredState.actors\n              ) {\n                window.drawActors({\n                  actors: lastAlteredState.actors.filter(d =>\n                    selectedActors.includes(d.id)\n                  )\n                })\n              }\n\n              // Clear logs after drawing.\n              this.sendLogsToParent()\n\n              // Draw to canvas right now.\n              this.writePixelDataToCanvas()\n\n              // Finally, set the store to point to the timeLineIndex altered state,\n              // so that when we hit play, we can resume right from this point.\n              this.store = createStore(this.reducer, stateToDraw)\n\n              this.setState({\n                alteredStates,\n                actors,\n                timelineIndex: newTimelineIndex\n              })\n            }\n            this.sendErrorToParent({ type: 'isPaused' })\n          } catch (e) {\n            this.sendErrorToParent({ type: 'isPaused', error: e })\n          }\n        } else {\n          // If the ul buttons don't have any canvases, add them!\n          const buttons = [...this._ul.querySelectorAll('button')]\n          const canvases = [...this._ul.querySelectorAll('canvas')]\n\n          if (buttons.length !== canvases.length) {\n            actors.forEach((actor, i) => {\n              // Fill the buffer with 0.\n              this._pixelData.pixels.fill(0)\n\n              // Draw this actor on the center of the screen.\n              window.drawActors({\n                actors: [\n                  {\n                    ...actor,\n                    x: 64,\n                    y: 64\n                  }\n                ]\n              })\n\n              // Draw to canvas right now.\n              this.writePixelDataToCanvas()\n\n              // Get its canvas.\n              const lilCanvas = trimCanvas({\n                ctx: this._canvas.getContext('2d'),\n                width: CANVAS_SIZE,\n                height: CANVAS_SIZE\n              })\n\n              // and append to button.\n              buttons[i].appendChild(lilCanvas)\n            })\n\n            this.drawUserGraphics(this.store.getState())\n          }\n        }\n      }\n      // If we got to this point, send a null error to parent.\n      this.sendErrorToParent({ type: 'componentDidMount' })\n    } catch (e) {\n      // Error! Send it to parent.\n      this.sendErrorToParent({ type: 'componentDidMount', error: e })\n    }\n\n    // If we haven't started the timer yet, do so now.\n    if (!this.timer && !isPaused) {\n      this.startTimer()\n    }\n\n    // If we had a message,\n    if (message) {\n      // send the height to parent.\n      const height = document.body.querySelector('.container').scrollHeight\n      if (height !== this.heightSent && !this.isEmbed) {\n        message.ports[0].postMessage({ height })\n        this.heightSent = height\n      }\n    }\n  }\n\n  render() {\n    const {\n      isPaused,\n      actors,\n      alteredStates,\n      timelineIndex,\n      selectedActors,\n      fps,\n      run,\n      started,\n      isTouchScreen\n    } = this.state\n\n    return (\n      <div className=\"Iframe\">\n        <div className=\"container\">\n          <canvas\n            className=\"master\"\n            width={CANVAS_SIZE}\n            height={CANVAS_SIZE}\n            ref={_canvas => {\n              this._canvas = _canvas\n            }}\n          />\n\n          <div\n            className={classNames('mobile-buttons', {\n              show: run && isTouchScreen\n            })}\n          >\n            <div\n              ref={this.setArrowLeftRef}\n              className=\"button left\"\n              onTouchStart={this.touchstartArrowLeft}\n              onTouchEnd={this.touchendArrowLeft}\n            >\n              &lt;\n            </div>\n            <div\n              ref={this.setArrowUpRef}\n              className=\"button up\"\n              onTouchStart={this.touchstartArrowUp}\n              onTouchEnd={this.touchendArrowUp}\n            >\n              <span>&gt;</span>\n            </div>\n            <div\n              ref={this.setArrowRightRef}\n              className=\"button right\"\n              onTouchStart={this.touchstartArrowRight}\n              onTouchEnd={this.touchendArrowRight}\n            >\n              &gt;\n            </div>\n            <div\n              ref={this.setaRef}\n              className=\"button a\"\n              onTouchStart={this.touchstarta}\n              onTouchEnd={this.touchenda}\n            >\n              A\n            </div>\n            <div\n              ref={this.setbRef}\n              className=\"button b\"\n              onTouchStart={this.touchstartb}\n              onTouchEnd={this.touchendb}\n            >\n              B\n            </div>\n            <div\n              ref={this.setArrowDownRef}\n              className=\"button down\"\n              onTouchStart={this.touchstartArrowDown}\n              onTouchEnd={this.touchendArrowDown}\n            >\n              <span>&lt;</span>\n            </div>\n            <div\n              ref={this.setSpaceRef}\n              className=\"button select\"\n              onTouchStart={this.touchstartSpace}\n              onTouchEnd={this.touchendSpace}\n            >\n              Select\n            </div>\n            <div\n              ref={this.setEnterRef}\n              className=\"button start\"\n              onTouchStart={this.touchstartEnter}\n              onTouchEnd={this.touchendEnter}\n            >\n              Start\n            </div>\n          </div>\n          <div className={classNames('stats', { invisible: run && !started })}>\n            <button className=\"button play\" onClick={this.handlePauseClick}>\n              {isPaused ? 'play' : 'pause'}\n            </button>\n\n            <button\n              className={classNames('button play', {\n                hide: isPaused\n              })}\n              onClick={this.handleRestartClick}\n            >\n              restart\n            </button>\n\n            <div\n              className={classNames('fps', {\n                hide: isPaused || true\n              })}\n            >\n              fps (avg): <span>{fps}</span>\n            </div>\n          </div>\n          <div\n            className={classNames('timeline', {\n              hide: run || alteredStates.length === 0,\n              invisible: !isPaused\n            })}\n          >\n            <input\n              type=\"range\"\n              value={timelineIndex}\n              min={0}\n              max={alteredStates.length - 1}\n              onChange={this.handleTimelineInput}\n            />\n            <ul\n              ref={_ul => {\n                this._ul = _ul\n              }}\n            >\n              {actors.map((actor, i) => (\n                <li\n                  key={actor.id}\n                  className={classNames({\n                    hide: i > 6\n                  })}\n                >\n                  <button\n                    className={classNames({\n                      active: selectedActors.includes(actor.id)\n                    })}\n                    onClick={() => this.handleActorClick(actor.id)}\n                  />\n                </li>\n              ))}\n            </ul>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default Iframe\n","const screenTypes = {\n  BOOT: 'BOOT',\n  HOME: 'HOME',\n  RUN: 'RUN',\n  HELP: 'HELP',\n  CODE: 'CODE',\n  SPRITE: 'SPRITE',\n  MAP: 'MAP',\n  SONG: 'SONG',\n  CHAIN: 'CHAIN',\n  PHRASE: 'PHRASE',\n  SHELF: 'SHELF'\n}\n\nconst cycleOrder = [\n  screenTypes.HOME,\n  screenTypes.CODE,\n  screenTypes.SPRITE,\n  screenTypes.MAP,\n  screenTypes.PHRASE,\n  screenTypes.CHAIN,\n  screenTypes.SONG,\n  screenTypes.HELP,\n  screenTypes.SHELF,\n  screenTypes.RUN\n]\n\nconst getNextScreen = screen => {\n  const index = cycleOrder.indexOf(screen)\n  return cycleOrder[(index + 1) % cycleOrder.length]\n}\n\nconst getPreviousScreen = screen => {\n  const index = cycleOrder.indexOf(screen)\n  return cycleOrder[(index - 1 + cycleOrder.length) % cycleOrder.length]\n}\n\nexport { getNextScreen, getPreviousScreen }\n\nexport default screenTypes\n","import screenTypes from '../utils/screenTypes.js'\nimport blankTemplate from '../blankTemplate.js'\nimport { version } from '../../package.json'\n\n// TODO: why do we have to make game keys?\nconst initialState = {\n  hideMenu: true,\n  iframeVersion: version,\n  errorLine: null,\n  screen: screenTypes.BOOT,\n  // screen: screenTypes.HOME,\n  booted: false,\n  gist: {},\n  game: {\n    0: {\n      text: blankTemplate,\n      active: true,\n      key: 0\n    }\n  },\n  token: {},\n  nextAction: null,\n  sprites: {},\n  map: [],\n  phrases: {},\n  chains: {},\n  songs: {},\n  docHistories: {},\n  dismissedNotices: [],\n  selectedUi: {\n    phrase: 0,\n    chain: 0,\n    song: 0\n  },\n  // tutorial: {\n  //   lessonIndex: 1,\n  //   slideIndex: 0\n  // },\n  tutorial: null,\n  sound: true,\n  shelving: false\n}\n\nexport default initialState\n","export default `init = state => {\n}\n\nupdate = (state, input, elapsed) => {\n}\n\ndraw = state => {\n}`\n","import { version } from '../../package.json'\nimport skeleton from '../skeleton.js'\nconst boot = `\n\nconst modes = ['glitch', 'numbers', 'pre-ram', 'ram', 'run', 'end']\n\nconst size = range(128)\nconst d = 1\n\nconst rects = flatten(size.map(x => size.map(y => [x, y, d, 128])))\n\nconst biosLines = range(18).map(() => {\n  return (\n    '  ' +\n    range(4)\n      .map(() => random(1000, 9999))\n      .join('      ')\n  )\n})\n\nif (typeof(initialState) !== 'undefined') {\n  initialState = {\n    counter: 0,\n    totalElapsed: 0,\n    modeIndex: 0,\n    hasStarted: false\n  }\n}\n\ninit = state => {\n  state.counter = 0\n  state.totalElapsed = 0\n  state.modeIndex = 0\n  state.hasStarted = false\n}\n\nupdate = (state, input, elapsed) => {\n  if (!state.hasStarted) {\n    state.hasStarted = true\n  }\n\n  const mode = modes[state.modeIndex]\n\n  state.counter++\n  state.totalElapsed += elapsed\n\n  if (mode === 'glitch' && state.totalElapsed > 500) {\n    state.modeIndex++\n    state.totalElapsed = 0\n  } else if (mode === 'numbers' && state.totalElapsed > 100) {\n    state.modeIndex++\n    state.totalElapsed = 0\n  } else if (mode === 'pre-ram' && state.totalElapsed > 100) {\n    state.modeIndex++\n    state.totalElapsed = 0\n    state.counter = 0\n  } else if (mode === 'ram' && state.counter > 64 && _script8.end) {\n    // The _script8.end function is not defined until we're done fetching the gist.\n    state.modeIndex++\n    state.totalElapsed = 0\n    state.counter++\n  } else if (mode === 'run') {\n    if (input.__mousedown) {\n      ${skeleton}\n      _script8.end()\n    }\n  }\n}\n\ndraw = state => {\n  const { modeIndex, counter } = state\n  const mode = modes[modeIndex]\n\n  if (mode === 'glitch') {\n    rects.forEach(rect => {\n      rectFill(...rect, rect[0] + (rect[1] * counter) / 100)\n    })\n  }\n\n  if (mode === 'numbers') {\n    const factor = 4\n    if (counter % factor === 0) {\n      rectFill(0, 0, 128, 128, 7)\n      biosLines.forEach((line, j) => {\n        print(0, 128 + 7 * j - (7 * counter) / factor, line, 5)\n      })\n    }\n  }\n\n  if (mode === 'pre-ram') {\n    rectFill(0, 0, 128, 128, 7)\n  }\n\n  if (mode === 'ram') {\n    rectFill(0, 0, 128, 128, 6)\n    print(7, 7 * 1, 'script-8', 0)\n    print(7, 7 * 3, 'bios (c) 1980 pantron inc.', 3)\n    print(7, 7 * 4, 'version ${version}', 3)\n    print(7, 7 * 6, 'RAM: ' + Math.min(state.counter, 32) + ' kb', 3)\n\n    print(\n      7,\n      7 * 9,\n      'booting cassette ' +\n        (Math.floor(state.counter / 20) % 2 === 0 ? '' : '+'),\n      3\n    )\n\n    rectFill(48 + 3 * 0, 7, 3, 5, 0)\n    rectFill(48 + 3 * 1, 7, 3, 5, 1)\n    rectFill(48 + 3 * 2, 7, 3, 5, 2)\n    rectFill(48 + 3 * 3, 7, 3, 5, 3)\n    rectFill(48 + 3 * 4, 7, 3, 5, 4)\n    rectFill(48 + 3 * 5, 7, 3, 5, 5)\n    rectFill(48 + 3 * 6, 7, 3, 5, 4)\n    rectFill(48 + 3 * 7, 7, 3, 5, 3)\n    rectFill(48 + 3 * 8, 7, 3, 5, 2)\n    rectFill(48 + 3 * 9, 7, 3, 5, 1)\n    rectFill(48 + 3 * 10, 7, 3, 5, 0)\n  }\n\n  if (mode === 'run') {\n    rectFill(0, 0, 128, 128, 6)\n    print(7, 7 * 1, 'script-8', 0)\n    print(7, 7 * 3, 'bios (c) 1980 pantron inc.', 3)\n    print(7, 7 * 4, 'version ${version}', 3)\n    print(7, 7 * 6, 'RAM: ' + Math.min(state.counter, 32) + ' kb', 3)\n\n    print(7, 7 * 9, 'booting cassette done. ', 3)\n\n    rectFill(48 + 3 * 0, 7, 3, 5, 0)\n    rectFill(48 + 3 * 1, 7, 3, 5, 1)\n    rectFill(48 + 3 * 2, 7, 3, 5, 2)\n    rectFill(48 + 3 * 3, 7, 3, 5, 3)\n    rectFill(48 + 3 * 4, 7, 3, 5, 4)\n    rectFill(48 + 3 * 5, 7, 3, 5, 5)\n    rectFill(48 + 3 * 6, 7, 3, 5, 4)\n    rectFill(48 + 3 * 7, 7, 3, 5, 3)\n    rectFill(48 + 3 * 8, 7, 3, 5, 2)\n    rectFill(48 + 3 * 9, 7, 3, 5, 1)\n    rectFill(48 + 3 * 10, 7, 3, 5, 0)\n    print(7, 7 * 11, '> click to run', 3)\n    rectFill(7, 7 * 12, 4, 5, Math.floor(state.counter / 25) % 2 ? 0 : 6)\n  }\n}\n\n`\n\nexport default boot\n","const pixelData = ({ width, height }) => {\n  // Pixel data has the actual image data object which can be passed to putImageData.\n  const _pixelData = new ImageData(width, height)\n\n  // This contains the actual binary data for setting on _pixelData. It cannot\n  // be accessed directly, but is instead modified through TypedArrays such as\n  // Uint8ClampedArray and Uint32Array. Both the TypedArrays below refer to\n  // the same backing buffer, so modifying values via one will be reflected in\n  // the other.\n  const _pixelBuffer = new ArrayBuffer(4 * width * height)\n\n  // The pixelBytes array is only used to set the data in the _pixelData\n  // object. ImageData only has an Uint8ClampedArray to access the underlying\n  // bytes, so a Uint8ClampedArray must be kept around to copy the data.\n  const _pixelBytes = new Uint8ClampedArray(_pixelBuffer)\n\n  // It turns out that setting pixels all at once via a single integer is much\n  // faster than setting each byte individually. So the pixel data is only\n  // ever modified via the Uint32Array for performance reasons.\n  const _pixelIntegers = new Uint32Array(_pixelBuffer)\n\n  const writePixelDataToCanvas = ctx => {\n    _pixelData.data.set(_pixelBytes)\n    ctx.putImageData(_pixelData, 0, 0)\n  }\n\n  return {\n    pixels: _pixelIntegers,\n    writePixelDataToCanvas\n  }\n}\n\nexport default pixelData\n","const trimCanvas = ({ ctx, width, height }) => {\n  const pixels = ctx.getImageData(0, 0, width, height)\n  const length = pixels.data.length\n  let i\n  const bound = {\n    top: null,\n    left: null,\n    right: null,\n    bottom: null\n  }\n  let x\n  let y\n\n  for (i = 0; i < length; i += 4) {\n    if (pixels.data[i + 3] !== 0) {\n      x = (i / 4) % width\n      y = ~~(i / 4 / width)\n\n      if (bound.top === null) {\n        bound.top = y\n      }\n\n      if (bound.left === null) {\n        bound.left = x\n      } else if (x < bound.left) {\n        bound.left = x\n      }\n\n      if (bound.right === null) {\n        bound.right = x\n      } else if (bound.right < x) {\n        bound.right = x\n      }\n\n      if (bound.bottom === null) {\n        bound.bottom = y\n      } else if (bound.bottom < y) {\n        bound.bottom = y\n      }\n    }\n  }\n\n  bound.bottom += 1\n  bound.right += 1\n\n  const copyCanvas = document.createElement('canvas')\n  const copy = copyCanvas.getContext('2d')\n  const trimHeight = bound.bottom - bound.top\n  const trimWidth = bound.right - bound.left\n  const side = Math.max(trimWidth, trimHeight)\n  const trimmed = ctx.getImageData(bound.left, bound.top, trimWidth, trimHeight)\n\n  copy.canvas.width = side\n  copy.canvas.height = side\n  copy.putImageData(trimmed, 0, 0)\n  return copyCanvas\n}\n\nexport default trimCanvas\n","const validateToken = ({ token, blacklist, globals, shadows }) => {\n  let isValid\n\n  // If user types a token in blacklist,\n  // it's most definitely invalid.\n  if (blacklist.has(token)) {\n    isValid = false\n  } else if (\n    // If user types a token defined in globals or updateableGlobals,\n    // it's valid.\n    globals.has(token)\n  ) {\n    isValid = true\n  } else if (window.hasOwnProperty(token)) {\n    // If user types a token on window scope (e.g. `screen`),\n    // add it to the list of __shadows, and make it valid.\n    shadows.add(token)\n    isValid = true\n  } else {\n    // Otherwise, return valid.\n    isValid = true\n  }\n\n  return isValid\n}\n\nexport default validateToken\n","const createReducer = logger => {\n  const reducer = (state = {}, action) => {\n    switch (action.type) {\n      case 'INIT': {\n        let newState\n        try {\n          // This approach mutates state.\n          newState = JSON.parse(JSON.stringify(state))\n          window.init(newState)\n\n          // This approach does not mutate state.\n          // newState = window.init() || {}\n\n          if (newState.actors) {\n            // Find actors with no id.\n            const namelessActors = newState.actors.filter(actor => !actor.id)\n            if (namelessActors.length) {\n              throw new Error('Actors must have an id property.')\n            }\n          }\n          logger({ type: 'reducerError' })\n        } catch (error) {\n          newState = state\n          logger({ type: 'reducerError', error })\n        } finally {\n          return newState\n        }\n      }\n      case 'UPDATE': {\n        let newState\n        try {\n          // This approach mutates state.\n          newState = JSON.parse(JSON.stringify(state))\n          window.update(newState, action.input, action.elapsed)\n\n          // This approach does not mutate state.\n          // newState = window.update(state, action.input, action.elapsed) || {}\n\n          if (newState.actors) {\n            // Find actors with no id.\n            const namelessActors = newState.actors.filter(actor => !actor.id)\n            if (namelessActors.length) {\n              throw new Error('Actors must have an id property.')\n            }\n          }\n          logger({ type: 'reducerError' })\n        } catch (error) {\n          newState = state\n          logger({ type: 'reducerError', error })\n        } finally {\n          return newState\n        }\n      }\n      default:\n        return state\n    }\n  }\n  return reducer\n}\n\nexport default createReducer\n","import _ from 'lodash'\nimport initialState from '../store/initialState.js'\n\nconst extractGistMap = data =>\n  JSON.parse(\n    _.get(\n      data,\n      'files[\"map.json\"].content',\n      JSON.stringify(initialState.map, null, 2)\n    )\n  )\n\nexport { extractGistMap }\n","import _ from 'lodash'\nimport initialState from '../store/initialState.js'\n\nconst extractGistSprites = data =>\n  JSON.parse(\n    _.get(\n      data,\n      'files[\"sprites.json\"].content',\n      JSON.stringify(initialState.sprites, null, 2)\n    )\n  )\nexport { extractGistSprites }\n","import _ from 'lodash'\nimport omitEmpty from 'omit-empty'\nimport initialState from '../store/initialState.js'\nimport toLetter, { letterToNumber } from '../toLetter.js'\n\nconst compressPhrases = phrases => {\n  const result = _.mapValues(phrases, phrase => {\n    const notes = _.map(phrase.notes, (note, noteIndex) =>\n      [noteIndex, toLetter(note.note), note.octave, note.volume].join('')\n    )\n    return {\n      notes,\n      tempo: _.isNil(phrase.tempo) ? 0 : phrase.tempo,\n      synth: _.isNil(phrase.synth) ? 0 : phrase.synth\n    }\n  })\n  return result\n}\n\nconst expandPhrases = phrases => {\n  // `phrases` is an object, e.g. (old style)\n  // {\n  //   \"0\": [\n  //     \"0f17\",\n  //     \"1g17\",\n  //     \"2a17\",\n\n  const result = omitEmpty(\n    _.mapValues(phrases, phrase => {\n      // If phrase is an array, it's an old kind. We have to convert it.\n      const phraseIsArray = Array.isArray(phrase)\n      const notes = _(phraseIsArray ? phrase : phrase.notes)\n        .map(note => note.match(/^(\\d+)([a-g]#?)(-?\\d)(\\d)/).slice(1, 5))\n        .map(match => ({\n          index: match[0],\n          note: letterToNumber(match[1]),\n          octave: +match[2],\n          volume: +match[3]\n        }))\n        .keyBy('index')\n        .mapValues(d => _.omit(d, 'index'))\n        .value()\n\n      return _.isEmpty(notes)\n        ? null\n        : {\n            notes,\n            tempo: phraseIsArray ? 0 : _.isNil(phrase.tempo) ? 0 : phrase.tempo,\n            synth: phraseIsArray ? 0 : _.isNil(phrase.synth) ? 0 : phrase.synth\n          }\n    })\n  )\n\n  return result\n}\n\nconst extractGistPhrases = data =>\n  expandPhrases(\n    JSON.parse(\n      _.get(\n        data,\n        'files[\"phrases.json\"].content',\n        JSON.stringify(initialState.phrases, null, 2)\n      )\n    )\n  )\n\nexport { extractGistPhrases, compressPhrases, expandPhrases }\n"],"sourceRoot":""}